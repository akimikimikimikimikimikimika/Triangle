(()=>{let html=document.documentElement,body=document.body;let ce=t=>document.createElement(t),cd=(i,c)=>{let e=ce("div");if (i) sa(e,"id",i);if (c) sc(e,c);return e;},ap=(p,c)=>p.appendChild(c),rc=c=>c.parentNode.removeChild(c),sa=(e,k,v)=>e.setAttribute(k,v),ra=(e,k)=>e.removeAttribute(k),sc=(e,c)=>{if (c) sa(e,"class",c);else ra(e,"class");},ael=(e,t,l,o)=>e.addEventListener(t,l,o);let tri=f=>{for (var n=0;n<3;n++) f(n,(n+1)%3,(n+2)%3);};let length=(p,q)=>Math.hypot(p.x-q.x,p.y-q.y);let plus=(p,q)=>({x:p.x+q.x,y:p.y+q.y});let minus=(p,q)=>({x:p.x-q.x,y:p.y-q.y});let times=(p,q)=>({x:p.x*q.x-p.y*q.y,y:p.x*q.y+p.y*q.x});let div=(p,q)=>coef(times(p,{x:q.x,y:-q.y}),1/(q.x**2+q.y**2));let coef=(p,k)=>({x:p.x*k,y:p.y*k});let mid=(p,q)=>coef(plus(p,q),0.5);let cross=(p,q)=>p.x*q.y-p.y*q.x;let copy=(f,t)=>{t.x=f.x;t.y=f.y;return t;};let add=(f,t)=>{t.x+=f.x;t.y+=f.y;return t;};let status=new Proxy({input:null,filter:true,standalone:false,save:false,browser:null },{set:(t,p,v)=>{t[p]=v;let c=[];if (!t.filter) c.push("no-filter");if (t.standalone) c.push("standalone");if (t.input=="Touch") c.push("touch");if (t.browser!=null) c.push(t.browser.toLowerCase());sc(html,c.join(" "));}});(()=>{let test=cd();status.input=test.ontouchstart===null?"Touch":"Mouse";if (!CSS) status.filter=false;else {if (CSS.supports("backdrop-filter","blur(5px)")||CSS.supports("-webkit-backdrop-filter","blur(5px)")) status.filter=true;else status.filter=false;}status.standalone=navigator.standalone===true||(/standalone=yes/).test(location.search);if (window.ApplePaySession) status.browser="Safari";if (window.chrome) status.browser="Chrome";if (window.sidebar) status.browser="Firefox";})();let fullscreen=()=>{if (document.webkitExitFullscreen) {if (document.webkitFullscreenElement) document.webkitExitFullscreen();else html.webkitRequestFullscreen();}else if (document.exitFullscreen) {if (document.fullscreenElement) document.exitFullscreen();else html.requestFullscreen();}};let package=(()=>{let Centers=[ {name:"ex",circle:true,key:"ex",pos:(m,n)=>s[m]*(n==m?-1:1),rad:n=>ar*2/(ss-2*s[n]) },{name:"in",circle:true,key:"in",pos:m=>s[m],rad:()=>ar*2/ss },{name:"g",circle:false,key:"g",pos:()=>1 },{name:"o",circle:true,key:"o",pos:m=>2*a[m].sin*a[m].cos,rad:ct=>length(ct.o,pt[0]) },{name:"h",circle:false,key:"h",pos:m=>a[m].tan,posR:w=>w },{name:"n",circle:true,key:"n",pos:(m,m1,m2)=>s[m]*(a[m1].sin*a[m2].sin+a[m1].cos*a[m2].cos),rad:ct=>ct.o.r/2 },{name:"x6",circle:false,key:"x6",pos:m=>s[m]**2 },{name:"br",circle:true,key:"br",pos1:(m,m1,m2)=>s[m]*s[m2]/s[m1],pos2:(m,m1,m2)=>s[m]*s[m1]/s[m2],br:(d,ct)=>{d.x=(ct.o.x+ct.x6.x)/2;d.y=(ct.o.y+ct.x6.y)/2;d.r=length(ct.o,d);let a=d.angle;a.tan=4*ar/Math.hypot(s[0],s[1],s[2])**2;a.sin=2*ar/Math.hypot(s[1]*s[2],s[2]*s[0],s[0]*s[1]);a.cos=a.sin/a.tan;a.deg=Math.asin(a.sin);}},{name:"x7",circle:false,key:"x7",pos:m=>1/(ss-2*s[m]) },{name:"x8",circle:false,key:"x8",pos:m=>ss-2*s[m] },{name:"x9",circle:false,key:"x9",pos:m=>1+a[m].cos },{name:"x10",circle:false,key:"x10",pos:m=>ss-s[m] },{name:"x11",circle:false,key:"x1112",pos:(m,m1,m2)=>((s[m1]-s[m2])**2)*(s[m1]+s[m2]-s[m]) },{name:"x12",circle:false,key:"x1112",pos:(m,m1,m2)=>((s[m1]+s[m2])**2)/(s[m1]+s[m2]-s[m]) },{name:"x13",circle:false,key:"x1314",pos:(m,m1,m2)=>s[m]**4-2*(s[m1]**2-s[m2]**2)**2+s[m]**2*(s[m1]**2+s[m2]**2+4*sq3*ar) },{name:"x14",circle:false,key:"x1314",pos:(m,m1,m2)=>s[m]**4-2*(s[m1]**2-s[m2]**2)**2+s[m]**2*(s[m1]**2+s[m2]**2-4*sq3*ar) },{name:"x15",circle:false,key:"x1516",pos:m=>s[m]*(a[m].sin+sq3*a[m].cos) },{name:"x16",circle:false,key:"x1516",pos:m=>s[m]*(a[m].sin-sq3*a[m].cos) },{name:"x17",circle:false,key:"x1718",pos:m=>s[m]/(sq3*a[m].sin+a[m].cos) },{name:"x18",circle:false,key:"x1718",pos:m=>s[m]/(sq3*a[m].sin-a[m].cos) },{name:"x19",circle:false,key:"x19",pos:m=>s[m]*a[m].tan,posR:w=>w },{name:"x20",circle:false,key:"x20",pos:(m,m1,m2)=>a[m1].tan+a[m2].tan-a[m].tan,posR:w=>w?-1:1 },{name:"x21",circle:false,key:"x21",pos:(m,m1,m2)=>s[m]/(a[m1].cos+a[m2].cos) },{name:"x22",circle:false,key:"x22",pos:(m,m1,m2)=>s[m]**2*(s[m1]**4+s[m2]**4-s[m]**4) },{name:"x23",circle:false,key:"x23",pos:(m,m1,m2)=>s[m]**2*(s[m1]**4+s[m2]**4-s[m]**4)-(s[0]*s[1]*s[2])**2 },{name:"x24",circle:false,key:"x24",pos:m=>-2*a[m].sin*a[m].cos+a[m].tan,posR:w=>w },{name:"x25",circle:false,key:"x25",pos:(m,m1,m2)=>s[m]**2/(s[m1]**2+s[m2]**2-s[m]**2) },{name:"x26",circle:false,key:"x26",pos:(m,m1,m2)=>s[m]**2*(s[m1]**2*(2*a[m1].cos**2-1)+s[m2]**2*(2*a[m2].cos**2-1)-s[m]**2*(2*a[m].cos**2-1)) },{name:"x27",circle:false,key:"x27",pos:m=>a[m].tan/(ss-s[m]),posR:w=>w },{name:"x28",circle:false,key:"x28",pos:m=>a[m].sin*a[m].tan/(ss-s[m]),posR:w=>w },{name:"x29",circle:false,key:"x29",pos:(m,m1,m2)=>a[m].tan/(a[m1].cos+a[m2].cos),posR:w=>w },{name:"x30",circle:false,key:"x30",pos:m=>s[m]*(a[m].sin*a[m].sin-3*a[m].cos*a[m].cos) },{name:"x31",circle:false,key:"x31",pos:m=>s[m]**3 },{name:"x32",circle:false,key:"x32",pos:m=>s[m]**4 },{name:"x33",circle:false,key:"x3334",pos:m=>a[m].sin+a[m].tan,posR:w=>w },{name:"x34",circle:false,key:"x3334",pos:m=>a[m].sin-a[m].tan,posR:w=>w },{name:"x35",circle:false,key:"x3536",pos:m=>a[m].sin*(1+2*a[m].cos) },{name:"x36",circle:false,key:"x3536",pos:m=>a[m].sin*(1-2*a[m].cos) },{name:"x37",circle:false,key:"x37",pos:m=>s[m]*(ss-s[m]) },{name:"x38",circle:false,key:"x38",pos:(m,m1,m2)=>s[m]*(s[m1]**2+s[m2]**2) },{name:"x39",circle:false,key:"x39",pos:(m,m1,m2)=>s[m]**2*(s[m1]**2+s[m2]**2) },{name:"x40",circle:false,key:"x40",pos:(m,m1,m2)=>s[m]*(a[m1].cos+a[m2].cos-a[m].cos-1) },{name:"x41",circle:false,key:"x41",pos:m=>s[m]**3*(ss-2*s[m]) },{name:"x42",circle:false,key:"x42",pos:m=>s[m]**2*(ss-s[m]) },{name:"x43",circle:false,key:"x43",pos:(m,m1,m2)=>s[m]**2*(ss-s[m])-s[m]*s[m1]*s[m2] },{name:"x44",circle:false,key:"x44",pos:m=>s[m]*(ss-3*s[m]) },{name:"x45",circle:false,key:"x45",pos:m=>s[m]*(2*ss-3*s[m]) },{name:"x46",circle:false,key:"x46",pos:(m,m1,m2)=>s[m]*(a[m1].cos+a[m2].cos-a[m].cos) },{name:"x47",circle:false,key:"x47",pos:m=>s[m]*(2*a[m].cos**2-1) },{name:"x48",circle:false,key:"x48",pos:(m,m1,m2)=>s[m]*(a[m1].tan+a[m2].tan) },{name:"x49",circle:true,key:"x49",pos:m=>a[m].sin*(4*a[m].cos**3-3*a[m].cos),rad:ct=>ct.o.r/Math.abs(1+8*a[0].cos*a[1].cos*a[2].cos) },];let Menus=[ {key:"ex",icon:"Ex",name:"Excenters / Excircles",panels:[{type:true},{type:false}] },{key:"in",icon:"In",name:"Incenter / Incircle",panels:[{type:true},{type:false}] },{key:"g",icon:"G",name:"Centroid",panels:[{type:true}] },{key:"o",icon:"O",name:"Circumcenter / Circumcircle",panels:[{type:true},{type:false}] },{key:"h",icon:"H",name:"Orthocenter",panels:[{type:true}] },{key:"n",icon:"N",name:"Nine-point Center / Circle",panels:[{type:true},{type:false}] },{key:"br",icon:"Br",name:"Brocard Points / Circle",panels:[{type:true,name:"Point"},{type:false}] },{key:"x6",icon:"6",name:"Symmedian Point",panels:[{type:true,name:"Point"}] },{key:"x7",icon:"7",name:"Gergonne Point",panels:[{type:true,name:"Point"}] },{key:"x8",icon:"8",name:"Nagel Point",panels:[{type:true,name:"Point"}] },{key:"x9",icon:"9",name:"Mittenpunkt",panels:[{type:true}] },{key:"x10",icon:"10",name:"Spieker Center",panels:[{type:true}] },{key:"x1112",icon:"11,12",name:"Feuerbach Points",panels:[ {type:true,icon:"● 1",name:"X11",key:"x11"},{type:true,icon:"● 2",name:"X12",key:"x12"}] },{key:"x1314",icon:"13,14",name:"Fermat Points",panels:[ {type:true,icon:"● 1",name:"1st Point (X13)",key:"x13"},{type:true,icon:"● 2",name:"2nd Point (X14)",key:"x14"}] },{key:"x1516",icon:"15,16",name:"Isodynamic Points",panels:[ {type:true,icon:"● 1",name:"1st Point (X15)",key:"x15"},{type:true,icon:"● 2",name:"2nd Point (X16)",key:"x16"}] },{key:"x1718",icon:"17,18",name:"Napoleon Points",panels:[ {type:true,icon:"● 17",name:"1st Point (X17)",key:"x17"},{type:true,icon:"● 18",name:"2nd Point (X18)",key:"x18"}] },{key:"x19",icon:"19",name:"Clawson Point",panels:[{type:true,name:"Point"}] },{key:"x20",icon:"20",name:"de Longchamps Point",panels:[{type:true,name:"Point"}] },{key:"x21",icon:"21",name:"Schiffler Point",panels:[{type:true,name:"Point"}] },{key:"x22",icon:"22",name:"Exeter Point",panels:[{type:true,name:"Point"}] },{key:"x23",icon:"23",name:"Far-Out Point",panels:[{type:true,name:"Point"}] },{key:"x24",icon:"24",name:"X(24)",panels:[{type:true}] },{key:"x25",icon:"25",name:"X(25)",panels:[{type:true}] },{key:"x26",icon:"26",name:"X(26)",panels:[{type:true}] },{key:"x27",icon:"27",name:"X(27)",panels:[{type:true}] },{key:"x28",icon:"28",name:"X(28)",panels:[{type:true}] },{key:"x29",icon:"29",name:"X(29)",panels:[{type:true}] },{key:"x30",icon:"30",name:"Euler Infinity Point",panels:[{type:true,name:"Point"}] },{key:"x31",icon:"31",name:"2nd Power Point",panels:[{type:true,name:"Point"}] },{key:"x32",icon:"X32",name:"3rd Power Point",panels:[{type:true,name:"Point"}] },{key:"x3334",icon:"33,34",name:"X(33), X(34)",panels:[ {type:true,icon:"● 33",name:"X33",key:"x33"},{type:true,icon:"● 34",name:"X34",key:"x34"}] },{key:"x3536",icon:"35,36",name:"X(35), X(36)",panels:[ {type:true,icon:"● 35",name:"X35",key:"x35"},{type:true,icon:"● 36",name:"X36",key:"x36"}] },{key:"x37",icon:"37",name:"X(37)",panels:[{type:true}] },{key:"x38",icon:"38",name:"X(38)",panels:[{type:true}] },{key:"x39",icon:"39",name:"Brocard Midpoint",panels:[{type:true,name:"Point"}] },{key:"x40",icon:"40",name:"Bevan Point",panels:[{type:true,name:"Point"}] },{key:"x41",icon:"41",name:"X(41)",panels:[{type:true}] },{key:"x42",icon:"42",name:"X(42)",panels:[{type:true}] },{key:"x43",icon:"43",name:"X(43)",panels:[{type:true}] },{key:"x44",icon:"44",name:"X(44)",panels:[{type:true}] },{key:"x45",icon:"45",name:"X(45)",panels:[{type:true}] },{key:"x46",icon:"46",name:"X(46)",panels:[{type:true}] },{key:"x47",icon:"47",name:"X(47)",panels:[{type:true}] },{key:"x48",icon:"48",name:"X(48)",panels:[{type:true}] },{key:"x49",icon:"49",name:"Sine-Triple-Angle Center / Circle",panels:[{type:true},{type:false}] }];let Style=[ {key:"triangleFill",value:"#7f7f7f"},{key:"exStroke",value:"hsl(0,100%,40%)"},{key:"inStroke",value:"hsl(0,100%,40%)"},{key:"gStroke",value:"hsl(300,100%,40%)"},{key:"oStroke",value:"hsl(240,100%,40%)"},{key:"hStroke",value:"hsl(180,100%,40%)"},{key:"nStroke",value:"hsl(120,100%,40%)"},{key:"brStroke",value:"hsl(0,100%,20%)"},{key:"x6Stroke",value:"hsl(15,100%,20%)"},{key:"x7Stroke",value:"hsl(30,100%,20%)"},{key:"x8Stroke",value:"hsl(45,100%,20%)"},{key:"x9Stroke",value:"hsl(60,100%,20%)"},{key:"x10Stroke",value:"hsl(75,100%,20%)"},{key:"x1112Stroke",value:"hsl(90,100%,20%)"},{key:"x1314Stroke",value:"hsl(105,100%,20%)"},{key:"x1516Stroke",value:"hsl(120,100%,20%)"},{key:"x1718Stroke",value:"hsl(135,100%,20%)"},{key:"x19Stroke",value:"hsl(150,100%,20%)"},{key:"x20Stroke",value:"hsl(165,100%,20%)"},{key:"x21Stroke",value:"hsl(180,100%,20%)"},{key:"x22Stroke",value:"hsl(195,100%,20%)"},{key:"x23Stroke",value:"hsl(210,100%,20%)"},{key:"x24Stroke",value:"hsl(225,100%,20%)"},{key:"x25Stroke",value:"hsl(240,100%,20%)"},{key:"x26Stroke",value:"hsl(255,100%,20%)"},{key:"x27Stroke",value:"hsl(270,100%,20%)"},{key:"x28Stroke",value:"hsl(285,100%,20%)"},{key:"x29Stroke",value:"hsl(300,100%,20%)"},{key:"x30Stroke",value:"hsl(315,100%,20%)"},{key:"x31Stroke",value:"hsl(330,100%,20%)"},{key:"x32Stroke",value:"hsl(345,100%,20%)"},{key:"x3334Stroke",value:"hsl(0,100%,20%)"},{key:"x3536Stroke",value:"hsl(24,100%,20%)"},{key:"x37Stroke",value:"hsl(48,100%,20%)"},{key:"x38Stroke",value:"hsl(72,100%,20%)"},{key:"x39Stroke",value:"hsl(96,100%,20%)"},{key:"x40Stroke",value:"hsl(120,100%,20%)"},{key:"x41Stroke",value:"hsl(144,100%,20%)"},{key:"x42Stroke",value:"hsl(168,100%,20%)"},{key:"x43Stroke",value:"hsl(192,100%,20%)"},{key:"x44Stroke",value:"hsl(216,100%,20%)"},{key:"x45Stroke",value:"hsl(240,100%,20%)"},{key:"x46Stroke",value:"hsl(264,100%,20%)"},{key:"x47Stroke",value:"hsl(288,100%,20%)"},{key:"x48Stroke",value:"hsl(312,100%,20%)"},{key:"x49Stroke",value:"hsl(336,100%,20%)"},{key:"exCenter"},{key:"exCircle"},{key:"inCenter"},{key:"inCircle"},{key:"gCenter"},{key:"oCenter"},{key:"oCircle"},{key:"hCenter"},{key:"nCenter"},{key:"nCircle"},{key:"brCenter"},{key:"brCircle"},{key:"x6Center"},{key:"x7Center"},{key:"x8Center"},{key:"x9Center"},{key:"x10Center"},{key:"x11Center"},{key:"x12Center"},{key:"x13Center"},{key:"x14Center"},{key:"x15Center"},{key:"x16Center"},{key:"x17Center"},{key:"x18Center"},{key:"x19Center"},{key:"x20Center"},{key:"x21Center"},{key:"x22Center"},{key:"x23Center"},{key:"x24Center"},{key:"x25Center"},{key:"x26Center"},{key:"x27Center"},{key:"x28Center"},{key:"x29Center"},{key:"x30Center"},{key:"x31Center"},{key:"x32Center"},{key:"x3334Center"},{key:"x3536Center"},{key:"x37Center"},{key:"x38Center"},{key:"x39Center"},{key:"x40Center"},{key:"x41Center"},{key:"x42Center"},{key:"x43Center"},{key:"x44Center"},{key:"x45Center"},{key:"x46Center"},{key:"x47Center"},{key:"x48Center"},{key:"x49Center"}];let presetPoints=[-120,120,-60,-180,120,0];let p={centers:()=>{let ct={},cp=w=>{let o={x:null,y:null,by:[],tri:[]};if (w) o.r=null;return o;};Centers.forEach(c=>{switch (c.name) {case "ex":ct.ex=[];tri(()=>ct.ex.push(cp(true)));break;case "br":ct.br1=cp(false),ct.br2=cp(false);ct.br={x:null,y:null,r:null,by:[],tri:[],angle:{cos:null,sin:null,tan:null,deg:null}};break;default:ct[c.name]=cp(c.circle);break;}});return ct;},centerNodes:()=>{let cn={},cc=n=>cd(null,"center "+n);Centers.forEach(c=>{let n=c.name;switch (n) {case "ex":cn.ex=[];tri(()=>cn.ex.push(cc(n)));break;case "br":cn.br=[cc(n),cc(n)];break;default:cn[n]=cc(n);break;}});return cn;},circleNodes:()=>{let cn={},cc=n=>cd(null,"circle "+n);Centers.forEach(c=>{let n=c.name;if (c.circle) switch (n) {case "ex":cn.ex=[];tri(()=>cn.ex.push(cc(n)));break;default:cn[n]=cc(n);break;}});return cn;},calc:tr=>{pt=tr.points,a=tr.angles,s=tr.sides;let ct=tr.centers;(()=>{tri((n,n1,n2)=>s[n]=length(pt[n1],pt[n2]));ss=s[0]+s[1]+s[2];tr.semi=ss/2;var m=1;tri((n,n1,n2)=>{a[n].cos=((s[n1]**2)+(s[n2]**2)-(s[n]**2))/(2*s[n1]*s[n2]);a[n].sin=(1-(a[n].cos**2))**0.5;a[n].tan=a[n].sin/a[n].cos;a[n].deg=Math.acos(a[n].cos)*180/Math.PI;m=Math.min(m,a[n].cos);});tr.max=mx=[];tri(n=>{if (m==a[n].cos) mx.push(n);});ar=(ss/2)**0.5;tri(n=>ar*=(ss/2-s[n])**0.5);tr.area=ar;if (!a[mx[0]].cos) {ra=[0,0,0];ra[mx[0]]=1;}else ra=null;})();(()=>{let f=(...arg)=>{let t=n=>arg[n]/s[n];let d=arg[3],bs=arg[0]+arg[1]+arg[2],ts=t(0)+t(1)+t(2);d.x=d.y=0;tri(n=>{d.by[n]=arg[n]/bs;d.tri[n]=t(n)/ts;add(coef(pt[n],d.by[n]),d);});};fq=(qa,o)=>f(qa(0,1,2),qa(1,2,0),qa(2,0,1),o);let cl=c=>{};Centers.forEach(c=>{let nm=c.name;switch (nm) {case "ex":tri(n=>{fq(m=>c.pos(m,n),ct.ex[n]);ct.ex[n].r=c.rad(n);});break;case "br":fq(c.pos1,ct.br1);fq(c.pos2,ct.br2);c.br(ct.br,ct);break;default:if (c.posR&&ra) {var y=c.posR(1),n=c.posR(0);f(ra[0]?y:n,ra[1]?y:n,ra[2]?y:n,ct[nm]);}else fq(c.pos,ct[nm]);if (c.rad) ct[nm].r=c.rad(ct);break;}});})();pt=[],a=[],s=[],mx=[],ss=0,ar=0,ra=null;},draw:(ctd,ctn,ccn)=>{let ct=c=>{let s=c[1].style,d=c[0];s.left=`calc( ${d.x}px + 50% )`;s.top= `calc( ${d.y}px + 50% )`;};let cc=c=>{let s=c[2].style,d=c[0];s.left= `calc( ${-d.r+d.x}px + 50% )`;s.right= `calc( ${-d.r-d.x}px + 50% )`;s.top= `calc( ${-d.r+d.y}px + 50% )`;s.bottom=`calc( ${-d.r-d.y}px + 50% )`;};Centers.forEach(c=>{let n=c.name;switch (n) {case "ex":tri(n=>{let d=[ctd.ex[n],ctn.ex[n],ccn.ex[n]];ct(d);cc(d);});break;case "br":ct([ctd.br1,ctn.br[0]]);ct([ctd.br2,ctn.br[1]]);cc([ctd.br,0,ccn.br]);break;default:var d=[ctd[n],ctn[n],ccn[n]];ct(d);if (d[2]) cc(d);break;}});},buildPanel:tr=>{let ur=[ {icon:"◀︎",name:"Undo",disabled:true,action:()=>his.revert(his.position-1) },{icon:"▶︎",name:"Redo",disabled:true,action:()=>his.revert(his.position+1) }];his.undoButtons.push(ur[0]);his.redoButtons.push(ur[1]);let pt=detail.panel([ [ {icon:"D",name:"Duplicate",action:()=>{let t=triangle.duplicate(tr);ap(draw,t.node);triangles.push(t);detail.hideDetail();his.backup();}},{icon:"╳",name:"Delete",action:()=>{detail.hideDetail();let trs=triangles;var d=trs.length;trs.forEach((tri,n)=>{if (d<n) trs[n-1]=trs[n];else if (trs[n]===tr) d=n;});trs.length--;tr.visible=false;rc(tr.node);tr.resignSelection();his.backup();}}],[ur[0],ur[1],{icon:"W",name:"Show/hide all centers",action:()=>{package.toggleWhole();;his.backup();}}] ]);pt.icon="▲";pt.name="Triangle";let pg=[pt];let p={triangle:pt};Menus.forEach(m=>{let pl=[];m.panels.forEach(dp=>{let f=dp.key?dp.key:m.key;let k=f+(dp.type?"Center":"Circle");let p={icon:dp.icon?dp.icon:(dp.type?"●":"◯"),name:"Show/Hide "+(dp.name?dp.name:(dp.type?"Center":"Circle")),type:dp.type,selected:false,action:()=>{tr.style[k]=!tr.style[k];tr.updateStyle();his.backup();}};Centers.find(c=>c.name==f).controllers.push(p);pl.push(p);});let ps=detail.panel([pl,ur]);ps.icon=m.icon;ps.name=m.name;p[m.key]=ps;pg.push(ps);});let g=detail.group(pg);his.urPanels.push(g);tr.panels=p;tr.panelGroup=g;},updateStyle:tr=>{let ps=tr.panels,st=tr.style,ct=tr.centerNodes,cc=tr.circleNodes;let f1=(e,t,n,k)=>{let c=k+"Stroke",v=n+(t?"Center":"Circle");e.style.borderColor=st[c];if ((!st[v])&&e.parentNode) rc(e);if (st[v]&&(!e.parentNode)) ap(tr.node,e);};let f2=(ct,t,n,k)=>{let c=k+"Stroke",v=n+(t?"Center":"Circle");ps[k].style.tintColor=st[c];ct.controllers.filter(v=>v.type==t).forEach(p=>p.selected=st[v]);};Centers.forEach(c=>{let n=c.name,k=c.key,ci=c.circle;switch (n) {case "ex":tri(m=>{f1(ct.ex[m],true,n,k);f1(cc.ex[m],false,n,k);});break;case "br":f1(ct.br[0],true,n,k);f1(ct.br[1],true,n,k);f1(cc.br,false,n,k);break;default:f1(ct[n],true,n,k);if (ci) f1(cc[n],false,n,k);break;}f2(c,true,n,k);if (ci) f2(c,false,n,k);});ps.triangle.style.tintColor=st.triangleFill;tr.panelGroup.update(true);},duplicateStyle:ps=>{if (!ps) var ps={};let st={};Style.forEach(s=>{if (ps[s.key]) st[s.key]=ps[s.key];else if (s.value) st[s.key]=s.value;else st[s.key]=false;});return st;},preset:()=>({data:[{points:presetPoints,style:triangle.duplicateStyle() }],triangle:[null] }),toggleWhole:()=>{let tr=selection;if (tr) {let st=tr.style,ps=Style.filter(s=>s.key.match("Center"));let w=ps.some(s=>st[s.key]);ps.forEach(s=>st[s.key]=!w);p.updateStyle(tr);}}};Centers.forEach(c=>c.controllers=[]);let sq3=3**0.5;var pt=[],a=[],s=[],mx=[],ss=0,ar=0,ra=null;return p;})();let triangle=(ax,ay,bx,by,cx,cy)=>{let ss=v=>{let z=tr.selectorSize;tr.selectorNode.forEach(n=>{let s=n.style;s.borderColor=`rgba(51,51,51,${z/100+0.6})`;s.borderWidth=z+"px";s.transform=`translate( -${z}px , -${z}px )`;});};let tr=new Proxy({points:[{x:ax,y:ay},{x:bx,y:by},{x:cx,y:cy}],angles:[],sides:[0,0,0],semi:0,area:0,container:{x1:0,y1:0,x2:0,y2:0},centers:package.centers(),max:[],node:cd(),triangleNode:cd(null,"triangle"),centerNodes:package.centerNodes(),circleNodes:package.circleNodes(),selectorNode:[],selectorSize:0,panelGroup:null,panels:null,style:triangle.duplicateStyle({}),visible:false,update:()=>{let ps=tr.points;let as=tr.angles;let ss=tr.sides;let ct=tr.centers;package.calc(tr);(()=>{let tc=tr.container;tc.x1=Math.min(ps[0].x,ps[1].x,ps[2].x);tc.y1=Math.min(ps[0].y,ps[1].y,ps[2].y);tc.x2=Math.max(ps[0].x,ps[1].x,ps[2].x);tc.y2=Math.max(ps[0].y,ps[1].y,ps[2].y);let ct=triangle.container;triangles.forEach(t=>{let tc=t.container;ct.x1=Math.min(tc.x1,ct.x1);ct.y1=Math.min(tc.y1,ct.y1);ct.x2=Math.max(tc.x2,ct.x2);ct.y2=Math.max(tc.y2,ct.y2);});})();(()=>{let m=tr.max[0];var ax=ps[(m+1)%3].x,ay=ps[(m+1)%3].y,bx=ps[(m+2)%3].x,by=ps[(m+2)%3].y,cx=ps[m].x,cy=ps[m].y;let k=-(ax*by)+(by*cx)-(cx*ay)+(ay*bx)-(bx*cy)+(cy*ax);if (k>0) {var t=[bx,by,ax,ay];ax=t[0];ay=t[1];bx=t[2];by=t[3];}let v=Math.hypot(bx-ax,by-ay);let sin=(by-ay)/v,cos=(bx-ax)/v;t=0+((bx-cx)*sin)-((by-cy)*cos);t=0+((ax-cx)*sin)-((ay-cy)*cos);let s=0+((bx-cx)*cos)+((by-cy)*sin);let r=0-((ax-cx)*cos)-((ay-cy)*sin);let q=cy-(t*cos);let p=cx+(t*sin);let st1=tr.triangleNode.style;st1.transform=`matrix( ${cos}, ${sin}, ${-sin}, ${cos}, ${p}, ${q} )`;st1.transformOrigin=r+"px top";st1.left=`calc( 50% - ${r}px )`;st1.right=`calc( 50% - ${s}px )`;st1.height=t+"px";let st2=tr.triangleNode.firstChild.style;st2.borderLeftWidth=r+"px";st2.borderRightWidth=s+"px";st2.borderTopWidth=t+"px";st2.borderTopColor=tr.style.triangleFill;})();let ctn=tr.centerNodes,ccn=tr.circleNodes,st=tr.style;package.draw(ct,tr.centerNodes,tr.circleNodes);tr.updateStyle();tri(n=>{let s=tr.selectorNode[n].style,p=tr.points[n];s.left=`calc( ${p.x}px + 50% )`;s.top =`calc( ${p.y}px + 50% )`;});return tr;},updateStyle:()=>package.updateStyle(tr),becomeSelection:()=>{if (selection) selection.resignSelection();sc(tr.node,"selected");detail.triggerColor(tr.panels.triangle);selection=tr;},resignSelection:()=>{sc(tr.node);detail.triggerColor();selection=null;}},{set:(t,p,v)=>{t[p]=v;if (p=="selectorSize") ss(v);}});tri(()=>{tr.angles.push({cos:0,sin:0,tan:0,deg:0});tr.selectorNode.push(cd(null,"selector"));});tr.selectorSize=status.input=="Touch"?20:10;package.buildPanel(tr);ap(tr.triangleNode,cd());[ tr.triangleNode,tr.selectorNode[0],tr.selectorNode[1],tr.selectorNode[2] ].forEach(n=>ap(tr.node,n));tr.update();return tr;};triangle.duplicate=tr=>{let tri=triangle( tr.points[0].x,tr.points[0].y,tr.points[1].x,tr.points[1].y,tr.points[2].x,tr.points[2].y );tri.style=triangle.duplicateStyle(tr.style);tri.update();return tri;};triangle.duplicateStyle=package.duplicateStyle;triangle.container={x1:0,y1:0,x2:0,y2:0};let triangles=[];var selection=null,editable=true;let base=cd("baseView");if (status.standalone) ap(base,cd("statusbar"));let axis=ap(base,cd("axisLayer"));axis.axisHidden=false;["Y","X"].forEach(a=>ap(axis,cd(null,"axis"+a)));let draw=ap(base,cd("drawLayer"));let his={data:[],position:0,storage:false,undoButtons:[],redoButtons:[],urPanels:[],save:()=>{if (his.storage) {try{localStorage.setItem("Triangle",JSON.stringify({data:his.data[his.position].data,axisHidden:axis.axisHidden }));}catch(e){his.storage=false;}}},backup:override=>{if (!override) his.data.length=his.position+1;let d=[],td=[];triangles.forEach((tr,n)=>{d[n]={points:[ tr.points[0].x,tr.points[0].y,tr.points[1].x,tr.points[1].y,tr.points[2].x,tr.points[2].y ],style:triangle.duplicateStyle(tr.style) };td[n]=tr;});if (!override) {his.data.push({data:d,triangle:td });his.undoButtons.forEach(e=>e.disabled=false);his.redoButtons.forEach(e=>e.disabled=true);his.position++;}else his.data[his.position]={data:d,triangle:td };his.save();},revert:p=>{if (selection) selection.resignSelection();his.position=p;let dt=his.data[p];let d=dt.data;while (triangles.length) {rc(triangles[0].node);triangles.shift().visible=false;}for (var n=0;n<d.length;n++) {let tr=dt.triangle[n];if (tr) {var pt=tr.points,pd=d[n].points;pt[0].x=pd[0];pt[0].y=pd[1];pt[1].x=pd[2];pt[1].y=pd[3];pt[2].x=pd[4];pt[2].y=pd[5];}else {let pd=d[n].points;tr=triangle(pd[0],pd[1],pd[2],pd[3],pd[4],pd[5]);dt.triangle[n]=tr;}tr.style=triangle.duplicateStyle(d[n].style?d[n].style:{});triangles[n]=tr;tr.update();ap(draw,tr.node);tr.visible=true;}his.save();his.undoButtons.forEach(e=>e.disabled=p==0);his.redoButtons.forEach(e=>e.disabled=p==(his.data.length-1));his.urPanels.forEach(e=>e.update());}};(()=>{try{let ls=localStorage.getItem("Triangle");if (ls) {let s=JSON.parse(ls),t=[];axis.axisHidden=!!s.axisHidden;sc(axis,axis.axisHidden?"hidden":"");if ((s.data?s.data:{}).length) {let d=s.data;d.forEach((de,n)=>t[n]=null);his.data[0]={data:d,triangle:t};his.storage=true;}else {his.storage=true;status.save=true;throw new Error("Error");}}else {his.storage=true;throw new Error("Error");}}catch(e){his.data[0]=package.preset();}})();let input=ap(base,cd("inputLayer"));(()=>{let focus=[];var focusType=null;var editable=true;var edited=false;var recomb=false;var duplicated=false;let adj=t=>{return {x:t.clientX-input.clientWidth/2,y:t.clientY-input.clientHeight/2};};let recombination=e=>{let fs=[];Array.from(e.touches).forEach(t=>{let ap=adj(t);let f=focus.reduce((a,f)=>{if (!a) return f;else if (length(ap,a)>length(ap,f)) return f;else return a;},null);if (f) {f.id=t.identifier;fs.push(f);}});if (fs.length) {focus.length=0;fs.forEach(f=>focus.push(f));}else cancel();recomb=false;};let into=ct=>ct.reduce((mt,t)=>{if (mt) {let ap=adj(t);let tr=triangles.find(tr=>{let p=tr.points;let det=cross(p[0],p[1])+cross(p[1],p[2])+cross(p[2],p[0]);if (det) {var j=1;tri((m,m1,m2)=>j&=(cross(p[m1],ap)-cross(p[m2],ap)-cross(p[m1],p[m2]))*det<0);return !!j;}else return false;});if (!tr) return 0;else if (mt==1) return tr;else if (mt===tr) return tr;else return 0;}else return 0;},1);let selectorSize=(e,w)=>{if (w) {if (!e.touches.length) var s=20;else if (e.touches[0].force!==undefined) var s=Array.from(e.touches).reduce((s,t)=>s+t.force/e.touches.length*20,20);else var s=20;}else {if (e.webkitForce!==undefined) var s=e.webkitForce*5+10;else var s=10;}if (focus.length) focus[0].triangle.selectorSize=s;};let cancel=()=>{focus.length=0;focusType=null;};if (status.input=="Touch") {ael(input,"touchstart",e=>{editable=false;let ct=Array.from(e.changedTouches),trs=triangles,fs=[];trs.reverse();ct.forEach(t=>{let ap=adj(t);trs.find(tr=>{let i=tr.points.findIndex(p=>length(ap,p)<=20);if (i>=0) fs.push({id:t.identifier,triangle:tr,corner:i,x:ap.x,y:ap.y});return i>=0;});});if (fs.length&&focusType!="Triangle") {if (fs.reduce((a,f)=>{if (a) {if (a==1) return f.triangle;else return a===f.triangle?f.triangle:0;}else return 0;},1)) {focusType="Point";fs.forEach(f=>focus.push(f));}else cancel();}else if (focus.length+ct.length>2) cancel();else if (focusType=="Triangle") {let tr=focus[0].triangle;if (fs.length) cancel();else if (into(ct)===tr) ct.forEach(t=>{let ap=adj(t);focus.push({id:t.identifier,triangle:tr,corner:-1,x:ap.x,y:ap.y});});else cancel();}else {let tr=into(ct);if (tr!=0&&tr!=1) {ct.forEach(t=>{let ap=adj(t);focus.push({id:t.identifier,triangle:tr,corner:-1,x:ap.x,y:ap.y});});focusType="Triangle";}}if (focus.length) {sa(input,"class","active");focus[0].triangle.becomeSelection();selectorSize(e,true);}else if (selection) selection.resignSelection();trs.reverse();e.preventDefault();});ael(input,"touchmove",e=>{sa(input,"class","moving"+(focus.length?" active":""));if (focus.length) {if (recomb) recombination(e);selectorSize(e,true);let tr=focus[0].triangle;let p=tr.points;if (focusType=="Point") {Array.from(e.changedTouches).forEach(t=>{let ap=adj(t);let f=focus.find(f=>f.id==t.identifier);if (f) {add(minus(ap,f),p[f.corner]);copy(ap,f);}});edited=true;tr.update();}else if (focusType=="Triangle") {if (focus.length==e.touches.length) switch (focus.length) {case 1:var ap=adj(e.touches[0]),f=focus[0];tri(n=>add(minus(ap,f),p[n]));copy(ap,f);break;case 2:let ap0=adj(e.touches[0]),ap1=adj(e.touches[1]);let f0=focus.find(f=>f.id==e.touches[0].identifier);let f1=focus.find(f=>f.id==e.touches[1].identifier);if (f0&&f1&&(f0!=f1)) {let c=mid(f0,f1),nc=mid(ap0,ap1),m=div(minus(ap0,ap1),minus(f0,f1));tri(n=>copy(plus(times(minus(p[n],c),m),nc),p[n]));copy(ap0,f0);copy(ap1,f1);}break;}edited=true;tr.update();}}e.preventDefault();});let te=e=>{if (e.touches.length) {var w=false;Array.from(e.touches).forEach(t=>{let ap=adj(t),f=focus.find(f=>f.id==t.identifier);if (f) {copy(ap,f);w=true;}});if (w) selectorSize(e,true);recomb=true;}else {if (edited) his.backup();focus.length=0;focusType=null;sc(input);editable=true;edited=false;}e.preventDefault();};ael(input,"touchend",te);ael(input,"touchcancel",te);ael(input,"touchforcechange",e=>selectorSize(e,true));}else {ael(input,"mousedown",e=>{editable=false;let ap=adj(e);triangles.find(tr=>{let i=tr.points.findIndex(p=>length(ap,p)<=10);if (i>=0) {focus.push({id:"mouse",triangle:tr,corner:i,x:ap.x,y:ap.y});focusType="Point";}return i>=0;});if (!focus.length) {let tr=into([e]);if (tr) {focus.push({id:"mouse",triangle:tr,corner:-1,x:ap.x,y:ap.y});focusType="Triangle";}}if (focus.length) {sa(input,"class","active");focus[0].triangle.becomeSelection();selectorSize(e,false);}else if (selection) selection.resignSelection();e.preventDefault();});ael(input,"mousemove",e=>{if (!editable) {sa(input,"class","moving"+(focus.length?" active":""));if (focus.length) {selectorSize(e,false);let ap=adj(e),f=focus[0];let tr=f.triangle;if (focusType=="Point") {let i=tr.centers.in;if (e.shiftKey&&e.altKey) {let m=div(minus(ap,i),minus(f,i));tr.points.forEach(p=>copy(plus(times(minus(p,i),m),i),p));}else if (e.shiftKey) {let l=length(tr.points[f.corner],i);tr.points.forEach(p=>copy(plus(coef(minus(p,i),length(ap,i)/l),i),p));}else if (e.altKey) {let m=div(coef(minus(ap,i),1/length(ap,i)),coef(minus(f,i),1/length(f,i)));tr.points.forEach(p=>copy(plus(times(minus(p,i),m),i),p));}else copy(ap,tr.points[f.corner]);edited=true;tr.update();}else if (focusType=="Triangle") {if (e.altKey&&!duplicated) {var tra=triangle.duplicate(tr);triangles.push(tra);tra.visible=true;draw.appendChild(tra.node);tr.resignSelection();tra.becomeSelection();f.triangle=tra;duplicated=true;selectorSize(e,false);}else var tra=tr;tra.points.forEach(p=>add(minus(ap,f),p));edited=true;tra.update();}copy(ap,f);}}e.preventDefault();});let mu=e=>{if (edited) his.backup();focusType=null;focus.length=0;editable=true;edited=false;duplicated=false;sc(input);e.preventDefault();};ael(input,"mouseup",mu);ael(input,"mouseout",mu);let fc=e=>{selectorSize(e,false);e.preventDefault();};ael(input,"webkitmouseforcedown",fc);ael(input,"webkitmouseforceup",fc);ael(input,"webkitmouseforcechanged",fc);}ael(html,"keydown",e=>{let s=selection,d=detail.runningDetail;if (s&&(!d)) {switch (e.key) {case "ArrowLeft":s.points.forEach(p=>p.x-=5);s.update();break;case "ArrowRight":s.points.forEach(p=>p.x+=5);s.update();break;case "ArrowUp":s.points.forEach(p=>p.y-=5);s.update();break;case "ArrowDown":s.points.forEach(p=>p.y+=5);s.update();break;}}e.preventDefault();});ael(html,"keyup",e=>{let s=selection;var d=detail.runningDetail;switch (e.key) {case "Enter":if (detail.runningDetail) {if (d.tabs) {var d=d.panels[d.focus];if (d.focus>=0) d.list[d.focus].panel.action(d,d.list[d.focus].panel);else if (d.focus==-1) detail.hideDetail();else d.group.setFocus(d.group.focus);}else {if (d.focus>=0) d.list[d.focus].panel.action(d,d.list[d.focus].panel);else detail.hideDetail();}}break;case "ArrowLeft":if (d) {if (d.tabs) {d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (l.col) d.setFocus(d.focus-1,true);else d.setFocus(-1);}else if (d.focus==-1) d.setFocus(d.list.length-1,true);else if (d.group.focus>0) d.group.setFocus(d.group.focus-1);}else {if (d.focus>=0) {var l=d.list[d.focus];if (l.col) d.setFocus(d.focus-1,true);else d.setFocus(-1);}else d.setFocus(d.list.length-1,true);}}else if (s) his.backup();break;case "ArrowRight":if (d) {if (d.tabs) {d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (d.panels[l.row].length-l.col-1) d.setFocus(d.focus+1);else d.setFocus(-1);}else if (d.focus==-1) d.setFocus(0,true);else if (d.group.focus<(d.group.panels.length-1)) d.group.setFocus(d.group.focus+1);}else {if (d.focus>=0) {var l=d.list[d.focus];if (d.panels[l.row].length-l.col-1) d.setFocus(d.focus+1);else d.setFocus(-1);}else d.setFocus(0,true);}}else if (s) his.backup();break;case "ArrowUp":if (d) {if (d.tabs) {var d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (l.row) {var m=d.panels[l.row-1].length;if (l.col>(m-1)) d.setFocus(d.focus-l.col-1,true);else d.setFocus(d.focus-m,true);}else d.group.setExtracted(false);}else d.setFocus(d.list.length-1,true);}else {if (d.focus>=0) {var l=d.list[d.focus];if (l.row) {var m=d.panels[l.row-1].length;if (l.col>(m-1)) d.setFocus(d.focus-l.col-1,true);else d.setFocus(d.focus-m,true);}else {var m=d.panels[d.panels.length-1].length;if (l.col>(m-1)) d.setFocus(d.list.length-1,true);else d.setFocus(d.list.length-m+l.col,true);}}else d.setFocus(d.list.length-1,true);}}else if (s) his.backup();break;case "ArrowDown":if (d) {if (d.tabs) {var d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (d.panels.length-l.row-1) {var m=d.panels[l.row+1].length,n=d.panels[l.row].length;if (l.col>(m-1)) d.setFocus(d.focus+n+m-l.col,false);else d.setFocus(d.focus+n,false);}else d.group.setExtracted(false);}else d.setFocus(0,true);}else {var d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (d.panels.length-l.row-1) {var m=d.panels[l.row+1].length,n=d.panels[l.row].length;if (l.col>(m-1)) d.setFocus(d.focus+n+m-l.col,false);else d.setFocus(d.focus+n,false);}else {var m=d.panels[0].length;if (l.col>(m-1)) d.setFocus(m-1,false);else d.setFocus(l.col,false);}}else d.setFocus(0,true);}}else if (s) his.backup();break;case "Backspace":if (d) detail.hideDetail();else if (s) {var d=triangles.length;for (var n=0;n<triangles.length;n++) {if (d<n) triangles[n-1]=triangles[n];else if (triangles[n]==s) d=n;}triangles.length--;s.visible=false;rc(selection.node);s.resignSelection();his.backup();}break;case "m":case "M":if (d) detail.hideDetail();else detail.showDetail();break;case "Z":var h=his.position+1;if (h<his.data.length) his.revert(h);break;case "z":var h=his.position-1;if (h>=0) his.revert(h);break;case "e":if (s) {s.style.exCenter=!s.style.exCenter;s.updateStyle();his.backup();}break;case "E":if (s) {s.style.exCircle=!s.style.exCircle;s.updateStyle();his.backup();}break;case "i":if (s) {s.style.inCenter=!s.style.inCenter;s.updateStyle();his.backup();}break;case "I":if (s) {s.style.inCircle=!s.style.inCircle;s.updateStyle();his.backup();}break;case "g":case "G":if (s) {s.style.gCenter=!s.style.gCenter;s.updateStyle();his.backup();}break;case "o":if (s) {s.style.oCenter=!s.style.oCenter;s.updateStyle();his.backup();}break;case "O":if (s) {s.style.oCircle=!s.style.oCircle;s.updateStyle();his.backup();}break;case "h":case "H":if (s) {s.style.hCenter=!s.style.hCenter;s.updateStyle();his.backup();}break;case "n":if (s) {s.style.nCenter=!s.style.nCenter;s.updateStyle();his.backup();}break;case "N":if (s) {s.style.nCircle=!s.style.nCircle;s.updateStyle();his.backup();}break;case "s":case "S":case "ß":case "Í":exp(true,e.altKey);case "b":case "B":case "∫":case "ı":exp(false,e.altKey);break;case "w":case "W":package.toggleWhole();break;case "p":case "P":window.print();break;case "f":case "F":fullscreen();break;}e.preventDefault();});})();let detail={};(()=>{let t=status.input=="Touch"?"touchend":"mouseup";let node=ap(base,cd("detailLayer","hide"));detail.panel=panel=>{let p=cd(null,"panel");let d=ap(p,cd(null,"done"));d.textContent=d.title="Done";switch (status.input) {case "Touch":ael(d,"touchend",e=>{if (view.focus==-1) detail.hideDetail();else view.setFocus(-1);e.cancelBubble=true;e.preventDefault();});break;case "Mouse":ael(d,"mouseover",e=>{view.setFocus(-1);e.cancelBubble=true;e.preventDefault();});ael(d,"mouseup",e=>{detail.hideDetail();e.cancelBubble=true;e.preventDefault();});break;}let view={panels:panel,list:[],style:{tintColor:"#007aff" },name:"",icon:"■",group:null,node:p,buttons:[],doneButton:d,backTint:ap(p,cd(null,"backTint")),desc:ap(p,cd(null,"desc")),visible:false,focus:0,update:()=>{view.list.length=0;view.panels.forEach((p,n)=>p.forEach((p,m)=>view.list.push({row:n,col:m,panel:p})));if (view.buttons.length>view.list.length) {for (var n=view.list.length;n<view.buttons.length;n++) rc(view.buttons[n]);view.buttons.length=view.list.length;}else if (view.buttons.length<view.list.length) {for (var n=view.buttons.length;n<view.list.length;n++) (n=>{let b=cd(null,"button");sa(b,"role","button");view.buttons[n]=b;var trigger=false;let p=()=>view.list[n].panel;switch (status.input) {case "Touch":ael(b,"touchstart",e=>{trigger=true;e.cancelBubble=true;e.preventDefault();});let tm=e=>{trigger=false;e.cancelBubble=true;e.preventDefault();};ael(b,"touchmove",tm);ael(b,"touchcancel",tm);ael(b,"touchend",e=>{if (trigger) {if (view.group) view.group.setExtracted(true);if (view.focus==n&&p().action) p().action(view,p());else if (!p().disabled) view.setFocus(n);trigger=false;}e.cancelBubble=true;e.preventDefault();});break;case "Mouse":ael(b,"mouseover",e=>{if (view.group) view.group.setExtracted(true);if (!p.disabled) view.setFocus(n);e.cancelBubble=true;e.preventDefault();});ael(b,"mouseup",e=>{if (p().action) p().action(view,p());e.cancelBubble=true;e.preventDefault();});break;}view.node.insertBefore(b,view.doneButton);})(n);}for (var n=-1;n<view.list.length;n++) {if (n>=0) {var b=view.buttons[n];let l=view.list[n];let p=l.panel;b.textContent=p.icon;b.title=p.name;b.style.color=view.style.tintColor;view.setSelected(n,p.selected);view.setPosition(b,l.col,l.row);sc(b,"button"+(p.disabled?" disabled":""));sa(b,"aria-disabled",view.list[n].panel.disabled?"true":"false");}else {var b=view.doneButton;b.style.color=view.style.tintColor;view.setPosition(b,3,view.panels.length-1);sa(b,"aria-disabled","false");}sa(b,"aria-selected","false");}view.backTint.style.backgroundColor=view.style.tintColor;view.setFocus(view.focus,false,true);if (!view.group) view.node.style.height=(85*view.panels.length+45)+"px";view.desc.style.color=view.style.tintColor;},setSelected:(n,t)=>{view.buttons[n].style.backgroundColor=t?translucent(view.style.tintColor,0.5):"transparent";view.list[n].panel.selected=!!t;},setFocus:(n,rev,all)=>{let l=view.list,f=view.focus;if (n>=0) {var b=n;if (l[n].panel.disabled) {if (all) {if (rev) for (var n=l.length+b;n>b;n--) {if (!l[n%l.length].panel.disabled) break;}else for (var n=b;n<l.length+b;n++) {if (!l[n%l.length].panel.disabled) break;}n=n%l.length;if (n==b) n=-1;}else {var found=false;if (rev) for (var n=b;n>=0;n--) {if (!l[n].panel.disabled) {found=true;break;}}else for (var n=b;n<l.length;n++) {if (!l[n].panel.disabled) {found=true;break;}}if (!found) n=-1;}}}var b=null;if (f>=0) {b=view.buttons[f];b.style.color=l[f].panel.disabled?"#999":view.style.tintColor;}else if (f==-1) {b=view.doneButton;b.style.color=view.style.tintColor;}else if (view.group&&(n>-2)) view.group.setExtracted(true);if (b) {sa(b,"aria-selected","false");b=null;}if (n>=0) {var b=view.buttons[n];view.setPosition(view.backTint,view.list[n].col,view.list[n].row);view.desc.textContent=view.list[n].panel.name;}else if (n==-1) {var b=view.doneButton;view.setPosition(view.backTint,3,view.panels.length-1);view.desc.textContent="";}else {view.setPosition(view.backTint,0,-1);view.desc.textContent=view.name;}if (b) {sa(b,"aria-selected","true");b.style.color="#fff";}view.focus=n;},setPosition:(n,c,r)=>{let rs=view.panels.length;if (r<0) {c=0;n.style.top="-85px";}else n.style.top=(85*r+5)+"px";n.style.left=`calc( ( 100% - 25px ) / 4 * ${c} + ${c*5+5}px )`;n.style.right=`calc( ( 100% - 25px ) / 4 * ${3-c} + ${-c*5+20}px )`;}};view.update();return view;};detail.group=panels=>{let g=cd(null,"group");ael(g,t,e=>{e.cancelBubble=true;e.preventDefault();});let np=cd(null,"nav");let nv=ap(np,cd(null,"extracted"));let gp={panels:panels,node:g,nav:nv,tabs:[],backFocus:ap(nv,cd(null,"backFocus")),backTint:ap(np,cd(null,"backTint")),focus:0,extracted:true,update:part=>{let p=gp.panels,t=gp.tabs,nd=gp.node,nv=gp.nav;if ((!part)||(t.length!=p.length)) {if (t.length>p.length) {for (var n=p.length;n<t.length;n++) rc(t[n]);t.length=p.length;}else if (t.length<p.length) {for (var n=t.length;n<p.length;n++) (n=>{let b=ap(nv,cd(null,"tab"));sa(b,"role","tab");t[n]=b;let c=ap(b,cd());var trigger=false;switch (status.input) {case "Touch":ael(c,"touchstart",e=>{trigger=true;e.cancelBubble=true;});ael(c,"touchmove",e=>{trigger=false;e.cancelBubble=true;});ael(c,"touchend",e=>{if (trigger) {gp.setExtracted(false);gp.setFocus(n);trigger=false;e.cancelBubble=true;}});break;case "Mouse":ael(c,"mouseover",e=>{gp.setExtracted(false);e.cancelBubble=true;});ael(c,"mouseup",e=>{gp.setFocus(n);e.cancelBubble=true;});break;}})(n);}while (nd.firstChild) rc(nd.firstChild);ap(nd,nv.parentNode);}p.forEach((pn,n)=>{let tn=t[n];tn.firstChild.textContent=pn.icon;tn.title=pn.name;tn.style.left=(65*n+5)+"px";tn.style.color=pn.style.tintColor;tn.index=n;ap(nd,pn.node);if (gp.focus==n&&pn.focus<-1) {pn.setFocus(0);gp.setExtracted(true);}else if (gp.focus!=n&&pn.focus>=-1) {pn.setFocus(-2);}pn.group=gp;pn.update();});gp.setFocus(part?gp.focus:0);gp.setExtracted(true);},setFocus:n=>{gp.tabs.forEach((t,m)=>{sc(t,"tab"+((n==m)?" selected":""));sc(gp.panels[m].node,"panel"+((n==m)?"":" hidden"));});let bf=gp.backFocus.style,pn=gp.panels[n];let pns=pn.style;gp.node.style.height=(85*pn.panels.length+95)+"px";bf.left=(65*n+5)+"px";bf.backgroundColor=pns.tintColor;gp.backTint.style.backgroundColor=translucent(pns.tintColor,status.filter?0.6:0.9);gp.focus=n;},setExtracted:e=>{sc(gp.nav,e?"extracted":"chooser");if (!e) gp.panels[gp.focus].setFocus(-2);gp.extracted=e;}};gp.update();return gp;};let translucent=(c,a)=>{let hsl=c.match(/hsl\(([0-9]+,[0-9]+\%,[0-9]+\%)\)/);if (hsl) return `hsla(${hsl[1]},${a})`;var rgb=c.match(/rgb\(([0-9]+,[0-9]+,[0-9]+)\)/);if (rgb) rgb=rgb[1];else {rgb=c.match(/\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i);if (rgb) rgb=[parseInt(rgb[1],16),parseInt(rgb[2],16),parseInt(rgb[3],16)];else rgb="0,0,0";}return `rgba(${rgb},${a})`;};let main=detail.panel([ [ {icon:"◀︎",name:"Undo",disabled:true,action:()=>his.revert(his.position-1) },{icon:"▶︎",name:"Redo",disabled:true,action:()=>his.revert(his.position+1) },{icon:"╋",name:"Show/Hide Axis",disabled:false,selected:!axis.axisHidden,action:(v,p)=>{axis.axisHidden=p.selected;sc(axis,p.selected?"hidden":"");v.setSelected(2,!p.selected);his.backup(true);}}],[ {icon:"R",name:"Call Preset",action:()=>{his.data.length=his.position+1;his.data.push(package.preset());his.revert(his.position+1);}},{icon:"P",name:"Print",action:()=>window.print() }] ]);his.urPanels.push(main);his.undoButtons.push(main.panels[0][0]);his.redoButtons.push(main.panels[0][1]);let trigger=ap(base,cd("detailTrigger"));detail.triggerColor=t=>{if (t) trigger.style.backgroundColor=t.style.tintColor;else trigger.style.backgroundColor=main.style.tintColor;};detail.triggerColor();detail.runningDetail=null;detail.showDetail=()=>{if (selection) {selection.update();ap(node,selection.panelGroup.node);selection.panelGroup.visible=true;detail.runningDetail=selection.panelGroup;}else {main.update();ap(node,main.node);main.visible=true;detail.runningDetail=main;}sc(node,"mid");setTimeout(()=>sc(node),0);};detail.hideDetail=()=>{sc(node,"mid");setTimeout(()=>{sc(node,"hide");if (detail.runningDetail) {rc(detail.runningDetail.node);detail.runningDetail.visible=false;detail.runningDetail=null;}},1000);};if (status.input=="Touch") ael(node,"touchmove",e=>e.preventDefault());ael(node,t,e=>{detail.hideDetail();e.preventDefault();});ael(trigger,t,detail.showDetail);})();let dialog=cd("dialogLayer","show");sc(dialog,"hide");let exp=(svg,only)=>{let ct=triangle.container;let z=only|axis.axisHidden;let w=ct.x2-ct.x1,h=ct.y2-ct.y1;if (svg) {var code=`<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="${w*1.2}" height="${h*1.2}" viewBox="${-w*0.1+ct.x1} ${-h*0.1+ct.y1} ${w*1.2} ${h*1.2}"><title>Triangle</title>`+(z?"":`<line x1="0" y1="${-h*0.1+ct.y1}" x2="0" y2="${h*0.1+ct.y2}" stroke-width="1" stroke="#666" /><line x1="${-w*0.1+ct.x1}" y1="0" x2="${w*0.1+ct.x2}" y2="0" stroke-width="1" stroke="#666" />`);triangles.forEach(tr=>{code+=`<path d="M${tr.points[0].x},${tr.points[0].y}L${tr.points[1].x},${tr.points[1].y}L${tr.points[2].x},${tr.points[2].y}Z" fill="${tr.style.triangleFill}" />`;var ex=0,br=0,exc=0;if (!only) Array.from(tr.node.childNodes).forEach((en,n)=>{if (n>1) {if (en.className.match(/center/)) {var k=en.className.match(/center ([a-z0-9]+)/)[1];var p=tr.centers[k];if (k=="ex") {code+=`<circle cx="${p[ex].x}" cy="${p[ex].y}" r="10" fill="${en.style.borderColor}" stroke="none" />`;ex++;}else if (k=="br") {code+=`<circle cx="${p[br].x}" cy="${p[br].y}" r="10" fill="${en.style.borderColor}" stroke="none" />`;br++;}else code+=`<circle cx="${p.x}" cy="${p.y}" r="10" fill="${en.style.borderColor}" stroke="none" />`;}if (en.className.match(/circle/)) {var k=en.className.match(/circle ([a-z0-9]+)/)[1];var p=tr.centers[k];if (k=="ex") {code+=`<circle cx="${p[exc].x}" cy="${p[exc].y}" r="${p[exc].r}" fill="none" stroke="${en.style.borderColor}" stroke-width="2" />`;exc++;}else code+=`<circle cx="${p.x}" cy="${p.y}" r="${p.r}" fill="none" stroke="${en.style.borderColor}" stroke-width="2" />`;}}});});code+="</svg>";window.open("data:image/svg+xml;base64,"+btoa(code));}else {var code=`<!doctype html><html><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" /><title>Triangle</title><style type="text/css">html,body{margin:0px;width:100%;height:100%;}@media print{#frame{position:absolute;left:0px;right:0px;top:0px;bottom:0px;}}@media screen{#frame{position:fixed;left:0px;right:0px;top:0px;bottom:0px;}}</style></head><body style="user-select:none;-webkit-user-select:none;cursor:default;"><div id="frame">`+(z?"":`<div style="border-right:solid #666 1px;position:absolute;z-index:1;left:0%;right:50%;top:0%;bottom:0%;"></div><div style="border-bottom:solid #666 1px;position:absolute;z-index:1;left:0%;right:0%;top:0%;bottom:50%;"></div>`);triangles.forEach(tr=>{var ce=0,ci=0;let tn=tr.triangleNode,cen=tr.centerNodes,cin=tr.circleNodes;let tnn=tn.firstChild;code+=`<div style="position:absolute;z-index:${z+1};top:50%;transform:${tn.style.transform};transform-origin:${tn.style.transformOrigin};left:${tn.style.left};right:${tn.style.right};height:${tn.style.height};"><div style="border:solid transparent 0px;border-left-width:${tnn.style.borderLeftWidth};border-right-width:${tnn.style.borderRightWidth};border-top-width:${tnn.style.borderTopWidth};border-top-color:${tnn.style.borderTopColor};position:absolute;left:0px;top:0px;width:0px;height:0px;"></div></div>`;if (!only) Array.from(tr.node.childNodes).forEach((en,n)=>{if (n>0) {if (en.className.match(/center/)) {ce=1;code+=`<div style="border:solid ${en.style.borderColor} 10px;border-radius:50%;transform:translate(-10px,-10px);position:absolute;z-index:${z+2};width:0px;height:0px;left:${en.style.left};top:${en.style.top};"></div>`;}if (en.className.match(/circle/)) {ci=1;code+=`<div style="border:solid ${en.style.borderColor} 2px;border-radius:50%;box-sizing:border-box;position:absolute;z-index:${z+2+ce};left:${en.style.left};right:${en.style.right};top:${en.style.top};bottom:${en.style.bottom};"></div>`;}}});z+=1+ce+ci;});code+="</div></body></html>";window.open("data:text/html;base64,"+btoa(code));}};his.revert(0);with (body) while (firstChild) rc(firstChild);ap(body,base);})();