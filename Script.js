(()=>{let html=document.documentElement,body=document.body;let ce=t=>document.createElement(t),cd=(i,c)=>{let e=ce("div");if (i) e.id=i;if (c) e.className=c;return e;},ap=(p,c)=>p.appendChild(c),rc=c=>c.parentNode.removeChild(c),sa=(e,k,v)=>e.setAttribute(k,v),ra=(e,k)=>e.removeAttribute(k),ael=(e,t,l,o)=>e.addEventListener(t,l,o),rel=(e,t)=>e.removeEventListener(t);let translucent=(c,a)=>{let hsl=c.match(/hsl\(([0-9]+,[0-9]+\%,[0-9]+\%)\)/);if (hsl) return "hsla("+hsl[1]+","+a+")";var rgb=c.match(/rgb\(([0-9]+,[0-9]+,[0-9]+)\)/);if (rgb) rgb=rgb[1];else {rgb=c.match(/\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i);if (rgb) rgb=[parseInt(rgb[1],16),parseInt(rgb[2],16),parseInt(rgb[3],16)];else rgb="0,0,0";}return "rgba("+rgb+","+a+")";};let preset=()=>({data:[{points:[-120,120,-60,-180,120,0],style:triangle.duplicateStyle() }],triangle:[null] });let tri=f=>{for (var n=0;n<3;n++) f(n,(n+1)%3,(n+2)%3);};let length=(p,q)=>Math.hypot(p.x-q.x,p.y-q.y);let plus=(p,q)=>({x:p.x+q.x,y:p.y+q.y});let minus=(p,q)=>({x:p.x-q.x,y:p.y-q.y});let times=(p,q)=>({x:p.x*q.x-p.y*q.y,y:p.x*q.y+p.y*q.x});let div=(p,q)=>coef(times(p,{x:q.x,y:-q.y}),1/(q.x**2+q.y**2));let coef=(p,k)=>({x:p.x*k,y:p.y*k});let mid=(p,q)=>coef(plus(p,q),0.5);let cross=(p,q)=>p.x*q.y-p.y*q.x;let copy=(f,t)=>{t.x=f.x;t.y=f.y;return t;};let add=(f,t)=>{t.x+=f.x;t.y+=f.y;return t;};let status=new Proxy({input:null,inputSetup:function(){switch (this.input) {case "Touch":detail.trigger.ontouchend=detail.trigger.method;detail.ontouchend=detail.method;detail.method=detail.trigger.method=null;break;case "Mouse":detail.trigger.onmouseup=detail.trigger.method;detail.onmouseup=detail.method;detail.method=detail.trigger.method=null;break;}},filter:true,standalone:false,browser:null },{set:(t,p,v)=>{t[p]=v;var c=[];if (!t.filter) c.push("no-filter");if (t.standalone) c.push("standalone");if (t.input=="Touch") c.push("touch");if (t.browser!=null) c.push(t.browser.toLowerCase());body.className=c.join(" ");}});(()=>{let test=cd();status.input=test.ontouchstart===null?"Touch":"Mouse";if (!CSS) status.filter=false;else {if (CSS.supports("backdrop-filter","blur(5px)")||CSS.supports("-webkit-backdrop-filter","blur(5px)")) status.filter=true;else status.filter=false;}status.standalone=!!navigator.standalone;if (window.ApplePaySession) status.browser="Safari";if (window.chrome) status.browser="Chrome";if (window.sidebar) status.browser="Firefox";})();let fullscreen=()=>{if (document.webkitExitFullscreen) {if (document.webkitFullscreenElement) document.webkitExitFullscreen();else html.webkitRequestFullscreen();}else if (document.exitFullscreen) {if (document.fullscreenElement) document.exitFullscreen();else html.requestFullscreen();}};let triangle=(ax,ay,bx,by,cx,cy)=>{let ur=[ {icon:"◀︎",name:"Undo",disabled:true,action:()=>his.revert(his.position-1) },{icon:"▶︎",name:"Redo",disabled:true,action:()=>his.revert(his.position+1) }];let ct=w=>{let o={x:null,y:null,by:[],tri:[]};if (w) o.r=null;return o;};let ss=v=>{let z=tr.selectorSize;tr.selectorNode.forEach(n=>{let s=n.style;s.borderColor=`rgba(51,51,51,${z/100+0.6})`;s.borderWidth=z+"px";s.transform=`translate( -${z}px , -${z}px )`;});};let tr=new Proxy({points:[{x:ax,y:ay},{x:bx,y:by},{x:cx,y:cy}],angles:[],sides:[0,0,0],semi:0,area:0,container:{x1:0,y1:0,x2:0,y2:0},centers:{ex:[ct(true),ct(true),ct(true)],in:ct(true),g:ct(false),o:ct(true),h:ct(false),n:ct(true),br1:ct(false),br2:ct(false),br:{x:null,y:null,by:[],tri:[],r:null,angle:{cos:null,sin:null,tan:null,deg:null}},x6:ct(false),x7:ct(false),x8:ct(false),x9:ct(false),x10:ct(false),x11:ct(false),x12:ct(false),x13:ct(false),x14:ct(false),x15:ct(false),x16:ct(false),x17:ct(false),x18:ct(false),x19:ct(false),x20:ct(false),x21:ct(false),x22:ct(false),x23:ct(false),x24:ct(false),x25:ct(false),x26:ct(false),x27:ct(false),x28:ct(false),x29:ct(false),x30:ct(false),x31:ct(false),x32:ct(false) },max:[],node:cd(),triangleNode:cd(null,"triangle"),centerNodes:{ex:[ cd(null,"center ex"),cd(null,"center ex"),cd(null,"center ex") ],in:cd(null,"center in"),g:cd(null,"center g"),o:cd(null,"center o"),h:cd(null,"center h"),n:cd(null,"center n"),br:[ cd(null,"center br"),cd(null,"center br") ],x6:cd(null,"center x6"),x7:cd(null,"center x7"),x8:cd(null,"center x8"),x9:cd(null,"center x9"),x10:cd(null,"center x10"),x11:cd(null,"center x11"),x12:cd(null,"center x12"),x13:cd(null,"center x13"),x14:cd(null,"center x14"),x15:cd(null,"center x15"),x16:cd(null,"center x16"),x17:cd(null,"center x17"),x18:cd(null,"center x18"),x19:cd(null,"center x19"),x20:cd(null,"center x20"),x21:cd(null,"center x21"),x22:cd(null,"center x22"),x23:cd(null,"center x23"),x24:cd(null,"center x24"),x25:cd(null,"center x25"),x26:cd(null,"center x26"),x27:cd(null,"center x27"),x28:cd(null,"center x28"),x29:cd(null,"center x29"),x30:cd(null,"center x30"),x31:cd(null,"center x31"),x32:cd(null,"center x32") },circleNodes:{in:cd(null,"circle in"),ex:[ cd(null,"circle ex"),cd(null,"circle ex"),cd(null,"circle ex") ],o:cd(null,"circle o"),n:cd(null,"circle n"),br:cd(null,"circle br") },selectorNode:[cd(null,"selector"),cd(null,"selector"),cd(null,"selector")],selectorSize:0,panelGroup:detail.group([ detail.panel([ [ {icon:"D",name:"Duplicate",action:()=>{let t=triangle.duplicate(tr);draw.appendChild(t.node);triangles.push(t);detail.hideDetail();his.backup();}},{icon:"╳",name:"Delete",action:()=>{detail.hideDetail();var d=triangles.length;for (var n=0;n<triangles.length;n++) {if (d<n) triangles[n-1]=triangles[n];else if (triangles[n]==tr) d=n;}triangles.length--;tr.visible=false;draw.removeChild(tr.node);tr.resignSelection();his.backup();}}],ur ]) ]),panels:{triangle:null,ex:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.exCenter=!tr.style.exCenter;tr.updateStyle();his.backup();}},{icon:"◯",name:"Show/Hide Circle",selected:false,action:function(){tr.style.exCircle=!tr.style.exCircle;tr.updateStyle();his.backup();}}],ur]),in:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.inCenter=!tr.style.inCenter;tr.updateStyle();his.backup();}},{icon:"◯",name:"Show/Hide Circle",selected:false,action:function(){tr.style.inCircle=!tr.style.inCircle;tr.updateStyle();his.backup();}}],ur]),g:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.gCenter=!tr.style.gCenter;tr.updateStyle();his.backup();}}],ur]),o:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.oCenter=!tr.style.oCenter;tr.updateStyle();his.backup();}},{icon:"◯",name:"Show/Hide Circle",selected:false,action:function(){tr.style.oCircle=!tr.style.oCircle;tr.updateStyle();his.backup();}}],ur]),h:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.hCenter=!tr.style.hCenter;tr.updateStyle();his.backup();}}],ur]),n:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.nCenter=!tr.style.nCenter;tr.updateStyle();his.backup();}},{icon:"◯",name:"Show/Hide Circle",selected:false,action:function(){tr.style.nCircle=!tr.style.nCircle;tr.updateStyle();his.backup();}}],ur]),br:detail.panel([[ {icon:"●",name:"Show/Hide Point",selected:false,action:function(){tr.style.brCenter=!tr.style.brCenter;tr.updateStyle();his.backup();}},{icon:"◯",name:"Show/Hide Circle",selected:false,action:function(){tr.style.brCircle=!tr.style.brCircle;tr.updateStyle();his.backup();}}],ur]),x6:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x6Center=!tr.style.x6Center;tr.updateStyle();his.backup();}}],ur]),x7:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x7Center=!tr.style.x7Center;tr.updateStyle();his.backup();}}],ur]),x8:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x8Center=!tr.style.x8Center;tr.updateStyle();his.backup();}}],ur]),x9:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x9Center=!tr.style.x9Center;tr.updateStyle();his.backup();}}],ur]),x10:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x10Center=!tr.style.x10Center;tr.updateStyle();his.backup();}}],ur]),x1112:detail.panel([[ {icon:"● 1",name:"Show/Hide X11",selected:false,action:function(){tr.style.x11Center=!tr.style.x11Center;tr.updateStyle();his.backup();}},{icon:"● 2",name:"Show/Hide X12",selected:false,action:function(){tr.style.x12Center=!tr.style.x12Center;tr.updateStyle();his.backup();}},],ur]),x1314:detail.panel([[ {icon:"● 1",name:"Show/Hide 1st Point (X13)",selected:false,action:function(){tr.style.x13Center=!tr.style.x13Center;tr.updateStyle();his.backup();}},{icon:"● 2",name:"Show/Hide 2nd Point (X14)",selected:false,action:function(){tr.style.x14Center=!tr.style.x14Center;tr.updateStyle();his.backup();}},],ur]),x1516:detail.panel([[ {icon:"● 1",name:"Show/Hide 1st Point (X15)",selected:false,action:function(){tr.style.x15Center=!tr.style.x15Center;tr.updateStyle();his.backup();}},{icon:"● 2",name:"Show/Hide 2nd Point (X16)",selected:false,action:function(){tr.style.x16Center=!tr.style.x16Center;tr.updateStyle();his.backup();}},],ur]),x1718:detail.panel([[ {icon:"● 1",name:"Show/Hide 1st Point (X17)",selected:false,action:function(){tr.style.x17Center=!tr.style.x17Center;tr.updateStyle();his.backup();}},{icon:"● 2",name:"Show/Hide 2nd Point (X18)",selected:false,action:function(){tr.style.x18Center=!tr.style.x18Center;tr.updateStyle();his.backup();}},],ur]),x19:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x19Center=!tr.style.x19Center;tr.updateStyle();his.backup();}}],ur]),x20:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x20Center=!tr.style.x20Center;tr.updateStyle();his.backup();}}],ur]),x21:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x21Center=!tr.style.x21Center;tr.updateStyle();his.backup();}}],ur]),x22:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x22Center=!tr.style.x22Center;tr.updateStyle();his.backup();}}],ur]),x23:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x23Center=!tr.style.x23Center;tr.updateStyle();his.backup();}}],ur]),x24:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x24Center=!tr.style.x24Center;tr.updateStyle();his.backup();}}],ur]),x25:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x25Center=!tr.style.x25Center;tr.updateStyle();his.backup();}}],ur]),x26:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x26Center=!tr.style.x26Center;tr.updateStyle();his.backup();}}],ur]),x27:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x27Center=!tr.style.x27Center;tr.updateStyle();his.backup();}}],ur]),x28:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x28Center=!tr.style.x28Center;tr.updateStyle();his.backup();}}],ur]),x29:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x29Center=!tr.style.x29Center;tr.updateStyle();his.backup();}}],ur]),x30:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x30Center=!tr.style.x30Center;tr.updateStyle();his.backup();}}],ur]),x31:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x31Center=!tr.style.x31Center;tr.updateStyle();his.backup();}}],ur]),x32:detail.panel([[ {icon:"●",name:"Show/Hide Center",selected:false,action:function(){tr.style.x32Center=!tr.style.x32Center;tr.updateStyle();his.backup();}}],ur]) },style:triangle.duplicateStyle({}),visible:false,update:()=>{let ps=tr.points;let as=tr.angles;let ss=tr.sides;let ct=tr.centers;(()=>{tri((n,n1,n2)=>ss[n]=length(ps[n1],ps[n2]));tr.semi=(ss[0]+ss[1]+ss[2])/2;var m=1;tri((n,n1,n2)=>{as[n].cos=((ss[n1]**2)+(ss[n2]**2)-(ss[n]**2))/(2*ss[n1]*ss[n2]);as[n].sin=(1-(as[n].cos**2))**0.5;as[n].tan=as[n].sin/as[n].cos;as[n].deg=Math.acos(as[n].cos);m=Math.min(m,as[n].cos);});tr.max=[];tri(n=>{if (m==as[n].cos) tr.max.push(n);});})();(()=>{tr.area=tr.semi**0.5;tri(n=>tr.area*=(tr.semi-ss[n])**0.5);})();(()=>{let tc=tr.container;tc.x1=Math.min(ps[0].x,ps[1].x,ps[2].x);tc.y1=Math.min(ps[0].y,ps[1].y,ps[2].y);tc.x2=Math.max(ps[0].x,ps[1].x,ps[2].x);tc.y2=Math.max(ps[0].y,ps[1].y,ps[2].y);let ct=triangle.container;triangles.forEach(t=>{let tc=t.container;ct.x1=Math.min(tc.x1,ct.x1);ct.y1=Math.min(tc.y1,ct.y1);ct.x2=Math.max(tc.x2,ct.x2);ct.y2=Math.max(tc.y2,ct.y2);});})();(()=>{let f=(...arg)=>{let t=n=>arg[n]/ss[n];let d=arg[3],s=arg[0]+arg[1]+arg[2],ts=t(0)+t(1)+t(2);d.x=d.y=0;tri(n=>{d.by[n]=arg[n]/s;d.tri[n]=t(n)/ts;add(coef(ps[n],d.by[n]),d);});},fq=(qa,o)=>f(qa(0,1,2),qa(1,2,0),qa(2,0,1),o);let fr=(t,f,o)=>{if (ra) {let y=t(1),n=t(0);f(ra[0]?y:n,ra[1]?y:n,ra[2]?y:n,o);}else fq(f,o);};let sq3=3**0.5;if (!as[tr.max[0]].cos) {var ra=[0,0,0];ra[tr.max[0]]=1;}else var ra=null;let sss=ss[0]+ss[1]+ss[2];tri(n=>{fq(m=>ss[m]*(n==m?-1:1),ct.ex[n]);ct.ex[n].r=tr.area*2/(sss-2*ss[n]);});fq(m=>ss[m],ct.in);ct.in.r=tr.area*2/sss;fq(()=>1,ct.g);fq(m=>2*as[m].sin*as[m].cos,ct.o);ct.o.r=length(ct.o,ps[0]);fr(w=>w,m=>as[m].tan,ct.h);fq((m,m1,m2)=>ss[m]*(as[m1].sin*as[m2].sin+as[m1].cos*as[m2].cos),ct.n);ct.n.r=ct.o.r/2;fq(m=>ss[m]**2,ct.x6);fq(m=>1/(sss-2*ss[m]),ct.x7);fq(m=>sss-2*ss[m],ct.x8);fq(m=>1+as[m].cos,ct.x9);fq(m=>sss-ss[m],ct.x10);fq((m,m1,m2)=>((ss[m1]-ss[m2])**2)*(ss[m1]+ss[m2]-ss[m]),ct.x11);fq((m,m1,m2)=>((ss[m1]+ss[m2])**2)/(ss[m1]+ss[m2]-ss[m]),ct.x12);fq((m,m1,m2)=>ss[m]**4-2*(ss[m1]**2-ss[m2]**2)**2+ss[m]**2*(ss[m1]**2+ss[m2]**2+4*sq3*tr.area),ct.x13);fq((m,m1,m2)=>ss[m]**4-2*(ss[m1]**2-ss[m2]**2)**2+ss[m]**2*(ss[m1]**2+ss[m2]**2-4*sq3*tr.area),ct.x14);fq(m=>ss[m]*(as[m].sin+sq3*as[m].cos),ct.x15);fq(m=>ss[m]*(as[m].sin-sq3*as[m].cos),ct.x16);fq(m=>ss[m]/(sq3*as[m].sin+as[m].cos),ct.x17);fq(m=>ss[m]/(sq3*as[m].sin-as[m].cos),ct.x18);fr(w=>w,m=>ss[m]*as[m].tan,ct.x19);fr(w=>w?-1:1,(m,m1,m2)=>as[m1].tan+as[m2].tan-as[m].tan,ct.x20);fq((m,m1,m2)=>ss[m]/(as[m1].cos+as[m2].cos),ct.x21);let pr=(ss[0]*ss[1]*ss[2])**2;fq((m,m1,m2)=>ss[m]**2*(ss[m1]**4+ss[m2]**4-ss[m]**4),ct.x22);fq((m,m1,m2)=>ss[m]**2*(ss[m1]**4+ss[m2]**4-ss[m]**4)-pr,ct.x23);fr(w=>w,m=>-2*as[m].sin*as[m].cos+as[m].tan,ct.x24);fq((m,m1,m2)=>ss[m]**2/(ss[m1]**2+ss[m2]**2-ss[m]**2),ct.x25);let f26=(a,b,c,d,e,f)=>a**2*(b**2*(2*e**2-1)+c**2*(2*f**2-1)-a**2*(2*d**2-1));fq((m,m1,m2)=>f26(ss[m],ss[m1],ss[m2],as[m].cos,as[m1].cos,as[m2].cos),ct.x26);fr(w=>w,(m,m1,m2)=>as[m].tan/(ss[m1]+ss[m2]),ct.x27);fr(w=>w,(m,m1,m2)=>as[m].sin*as[m].tan/(ss[m1]+ss[m2]),ct.x28);fr(w=>w,(m,m1,m2)=>as[m].tan/(as[m1].cos+as[m2].cos),ct.x29);fq((m,m1,m2)=>ss[m]*(as[m1].sin*as[m2].sin-3*as[m1].cos*as[m2].cos),ct.x30);fq(m=>ss[m]**3,ct.x31);fq(m=>ss[m]**4,ct.x32);fq((m,m1,m2)=>ss[m]*ss[m2]/ss[m1],ct.br1);fq((m,m1,m2)=>ss[m]*ss[m1]/ss[m2],ct.br2);ct.br.x=(ct.o.x+ct.x6.x)/2;ct.br.y=(ct.o.y+ct.x6.y)/2;ct.br.r=length(ct.o,ct.br);let a=ct.br.angle;a.tan=4*tr.area/Math.hypot(ss[0],ss[1],ss[2])**2;a.sin=2*tr.area/Math.hypot(ss[1]*ss[2],ss[2]*ss[0],ss[0]*ss[1]);a.cos=a.sin/a.tan;a.deg=Math.asin(a.sin);})();(()=>{let m=tr.max[0];var ax=ps[(m+1)%3].x,ay=ps[(m+1)%3].y,bx=ps[(m+2)%3].x,by=ps[(m+2)%3].y,cx=ps[m].x,cy=ps[m].y;let k=-(ax*by)+(by*cx)-(cx*ay)+(ay*bx)-(bx*cy)+(cy*ax);if (k>0) {var t=[bx,by,ax,ay];ax=t[0];ay=t[1];bx=t[2];by=t[3];}let v=Math.hypot(bx-ax,by-ay);let sin=(by-ay)/v,cos=(bx-ax)/v;t=0+((bx-cx)*sin)-((by-cy)*cos);t=0+((ax-cx)*sin)-((ay-cy)*cos);let s=0+((bx-cx)*cos)+((by-cy)*sin);let r=0-((ax-cx)*cos)-((ay-cy)*sin);let q=cy-(t*cos);let p=cx+(t*sin);let st1=tr.triangleNode.style;st1.transform=`matrix( ${cos}, ${sin}, ${-sin}, ${cos}, ${p}, ${q} )`;st1.transformOrigin=r+"px top";st1.left=`calc( 50% - ${r}px )`;st1.right=`calc( 50% - ${s}px )`;st1.height=t+"px";let st2=tr.triangleNode.firstChild.style;st2.borderLeftWidth=r+"px";st2.borderRightWidth=s+"px";st2.borderTopWidth=t+"px";st2.borderTopColor=tr.style.triangleFill;})();let ctn=tr.centerNodes,ccn=tr.circleNodes,st=tr.style;(()=>{[ {data:ct.ex[0],center:ctn.ex[0]},{data:ct.ex[1],center:ctn.ex[1]},{data:ct.ex[2],center:ctn.ex[2]},{data:ct.in ,center:ctn.in },{data:ct.g ,center:ctn.g },{data:ct.o ,center:ctn.o },{data:ct.h ,center:ctn.h },{data:ct.n ,center:ctn.n },{data:ct.br1 ,center:ctn.br[0]},{data:ct.br2 ,center:ctn.br[1]},{data:ct.x6 ,center:ctn.x6 },{data:ct.x7 ,center:ctn.x7 },{data:ct.x8 ,center:ctn.x8 },{data:ct.x9 ,center:ctn.x9 },{data:ct.x10 ,center:ctn.x10 },{data:ct.x11 ,center:ctn.x11 },{data:ct.x12 ,center:ctn.x12 },{data:ct.x13 ,center:ctn.x13 },{data:ct.x14 ,center:ctn.x14 },{data:ct.x15 ,center:ctn.x15 },{data:ct.x16 ,center:ctn.x16 },{data:ct.x17 ,center:ctn.x17 },{data:ct.x18 ,center:ctn.x18 },{data:ct.x19 ,center:ctn.x19 },{data:ct.x20 ,center:ctn.x20 },{data:ct.x21 ,center:ctn.x21 },{data:ct.x22 ,center:ctn.x22 },{data:ct.x23 ,center:ctn.x23 },{data:ct.x24 ,center:ctn.x24 },{data:ct.x25 ,center:ctn.x25 },{data:ct.x26 ,center:ctn.x26 },{data:ct.x27 ,center:ctn.x27 },{data:ct.x28 ,center:ctn.x28 },{data:ct.x29 ,center:ctn.x29 },{data:ct.x30 ,center:ctn.x30 },{data:ct.x31 ,center:ctn.x31 },{data:ct.x32 ,center:ctn.x32 }].forEach(p=>{let s=p.center.style,d=p.data;s.left=`calc( ${d.x}px + 50% )`;s.top= `calc( ${d.y}px + 50% )`;});})();(()=>{[ {data:ct.ex[0],circle:ccn.ex[0]},{data:ct.ex[1],circle:ccn.ex[1]},{data:ct.ex[2],circle:ccn.ex[2]},{data:ct.in ,circle:ccn.in },{data:ct.o ,circle:ccn.o },{data:ct.n ,circle:ccn.n },{data:ct.br ,circle:ccn.br }].forEach(p=>{let s=p.circle.style,d=p.data;s.left= `calc( ${-d.r+d.x}px + 50% )`;s.right= `calc( ${-d.r-d.x}px + 50% )`;s.top= `calc( ${-d.r+d.y}px + 50% )`;s.bottom=`calc( ${-d.r-d.y}px + 50% )`;});})();tr.updateStyle();tri(n=>{let s=tr.selectorNode[n].style,p=tr.points[n];s.left=`calc( ${p.x}px + 50% )`;s.top =`calc( ${p.y}px + 50% )`;});return tr;},updateStyle:()=>{let ct=tr.centerNodes,cc=tr.circleNodes,ps=tr.panels,st=tr.style;[ {n:ct.ex[0],ps:ps.ex,p:0,c:st.exStroke,v:st.exCenter},{n:cc.ex[0],ps:ps.ex,p:1,c:st.exStroke,v:st.exCircle},{n:ct.ex[1],ps:ps.ex,p:0,c:st.exStroke,v:st.exCenter},{n:cc.ex[1],ps:ps.ex,p:1,c:st.exStroke,v:st.exCircle},{n:ct.ex[2],ps:ps.ex,p:0,c:st.exStroke,v:st.exCenter},{n:cc.ex[2],ps:ps.ex,p:1,c:st.exStroke,v:st.exCircle},{n:ct.in ,ps:ps.in,p:0,c:st.inStroke,v:st.inCenter},{n:cc.in ,ps:ps.in,p:1,c:st.inStroke,v:st.inCircle},{n:ct.g ,ps:ps.g,p:0,c:st.gStroke,v:st.gCenter},{n:ct.o ,ps:ps.o,p:0,c:st.oStroke,v:st.oCenter},{n:cc.o ,ps:ps.o,p:1,c:st.oStroke,v:st.oCircle},{n:ct.h ,ps:ps.h,p:0,c:st.hStroke,v:st.hCenter},{n:ct.n ,ps:ps.n,p:0,c:st.nStroke,v:st.nCenter},{n:cc.n ,ps:ps.n,p:1,c:st.nStroke,v:st.nCircle},{n:ct.br[0],ps:ps.br,p:0,c:st.brStroke,v:st.brCenter},{n:ct.br[1],ps:ps.br,p:0,c:st.brStroke,v:st.brCenter},{n:cc.br ,ps:ps.br,p:1,c:st.brStroke,v:st.brCircle},{n:ct.x6 ,ps:ps.x6,p:0,c:st.x6Stroke,v:st.x6Center},{n:ct.x7 ,ps:ps.x7,p:0,c:st.x7Stroke,v:st.x7Center},{n:ct.x8 ,ps:ps.x8,p:0,c:st.x8Stroke,v:st.x8Center},{n:ct.x9 ,ps:ps.x9,p:0,c:st.x9Stroke,v:st.x9Center},{n:ct.x10 ,ps:ps.x10,p:0,c:st.x10Stroke,v:st.x10Center},{n:ct.x11 ,ps:ps.x1112,p:0,c:st.x1112Stroke,v:st.x11Center},{n:ct.x12 ,ps:ps.x1112,p:1,c:st.x1112Stroke,v:st.x12Center},{n:ct.x13 ,ps:ps.x1314,p:0,c:st.x1314Stroke,v:st.x13Center},{n:ct.x14 ,ps:ps.x1314,p:1,c:st.x1314Stroke,v:st.x14Center},{n:ct.x15 ,ps:ps.x1516,p:0,c:st.x1516Stroke,v:st.x15Center},{n:ct.x16 ,ps:ps.x1516,p:1,c:st.x1516Stroke,v:st.x16Center},{n:ct.x17 ,ps:ps.x1718,p:0,c:st.x1718Stroke,v:st.x17Center},{n:ct.x18 ,ps:ps.x1718,p:1,c:st.x1718Stroke,v:st.x18Center},{n:ct.x19 ,ps:ps.x19,p:0,c:st.x19Stroke,v:st.x19Center},{n:ct.x20 ,ps:ps.x20,p:0,c:st.x20Stroke,v:st.x20Center},{n:ct.x21 ,ps:ps.x21,p:0,c:st.x21Stroke,v:st.x21Center},{n:ct.x22 ,ps:ps.x22,p:0,c:st.x22Stroke,v:st.x22Center},{n:ct.x23 ,ps:ps.x23,p:0,c:st.x23Stroke,v:st.x23Center},{n:ct.x24 ,ps:ps.x24,p:0,c:st.x24Stroke,v:st.x24Center},{n:ct.x25 ,ps:ps.x25,p:0,c:st.x25Stroke,v:st.x25Center},{n:ct.x26 ,ps:ps.x26,p:0,c:st.x26Stroke,v:st.x26Center},{n:ct.x27 ,ps:ps.x27,p:0,c:st.x27Stroke,v:st.x27Center},{n:ct.x28 ,ps:ps.x28,p:0,c:st.x28Stroke,v:st.x28Center},{n:ct.x29 ,ps:ps.x29,p:0,c:st.x29Stroke,v:st.x29Center},{n:ct.x30 ,ps:ps.x30,p:0,c:st.x30Stroke,v:st.x30Center},{n:ct.x31 ,ps:ps.x31,p:0,c:st.x31Stroke,v:st.x31Center},{n:ct.x32 ,ps:ps.x32,p:0,c:st.x32Stroke,v:st.x32Center}].forEach(p=>{p.n.style.borderColor=p.c;if ((!p.v)&&p.n.parentNode) rc(p.n);if (p.v&&(!p.n.parentNode)) ap(tr.node,p.n);p.ps.style.tintColor=p.c;p.ps.panels[0][p.p].selected=p.v;});tr.panels.triangle.style.tintColor=tr.style.triangleFill;tr.panelGroup.update(true);},becomeSelection:()=>{if (selection) selection.resignSelection();tr.node.className="selected";detail.trigger.style.backgroundColor=tr.panels.triangle.style.tintColor;selection=tr;},resignSelection:()=>{tr.node.className="";detail.trigger.style.backgroundColor=detail.main.style.tintColor;selection=null;}},{set:(t,p,v)=>{t[p]=v;if (p=="selectorSize") ss(v);}});tri(()=>{tr.angles.push({cos:0,sin:0,tan:0,deg:0});});tr.selectorSize=status.input=="Touch"?20:10;let ps=tr.panels,pg=tr.panelGroup;let p=pg.panels[0];ps.triangle=p;p.icon="▲";p.name="Triangle";his.undoButtons.push(p.panels[1][0]);his.redoButtons.push(p.panels[1][1]);his.urPanels.push(pg);[ {p:ps.ex,i:"Ex",n:"Excenters / Excircles"},{p:ps.in,i:"In",n:"Incenter / Incircle"},{p:ps.g,i:"G",n:"Centroid"},{p:ps.o,i:"O",n:"Circumcenter / Circumcircle"},{p:ps.h,i:"H",n:"Orthocenter"},{p:ps.n,i:"N",n:"Nine-point Center / Circle"},{p:ps.br,i:"Br",n:"Brocard Points / Circle"},{p:ps.x6,i:"X6",n:"Symmedian Point"},{p:ps.x7,i:"X7",n:"Gergonne Point"},{p:ps.x8,i:"X8",n:"Nagel Point"},{p:ps.x9,i:"X9",n:"Mittenpunkt"},{p:ps.x10,i:"X10",n:"Spieker Center"},{p:ps.x1112,i:"X11,12",n:"Feuerbach Points"},{p:ps.x1314,i:"X13,14",n:"Fermat Points"},{p:ps.x1516,i:"X15,16",n:"Isodynamic Points"},{p:ps.x1718,i:"X17,18",n:"Napoleon Points"},{p:ps.x19,i:"X19",n:"Clawson Point"},{p:ps.x20,i:"X20",n:"de Longchamps Point"},{p:ps.x21,i:"X21",n:"Schiffler Point"},{p:ps.x22,i:"X22",n:"Exeter Point"},{p:ps.x23,i:"X23",n:"Far-Out Point"},{p:ps.x24,i:"X24",n:"X(24)"},{p:ps.x25,i:"X25",n:"X(25)"},{p:ps.x26,i:"X26",n:"X(26)"},{p:ps.x27,i:"X27",n:"X(27)"},{p:ps.x28,i:"X28",n:"X(28)"},{p:ps.x29,i:"X29",n:"X(29)"},{p:ps.x30,i:"X30",n:"Euler Infinity Point"},{p:ps.x31,i:"X31",n:"2nd Power Point"},{p:ps.x32,i:"X32",n:"3rd Power Point"}].forEach(p=>{p.p.icon=p.i;p.p.name=p.n;pg.panels.push(p.p);});ap(tr.triangleNode,cd());[ tr.triangleNode,tr.selectorNode[0],tr.selectorNode[1],tr.selectorNode[2] ].forEach(n=>ap(tr.node,n));tr.update();return tr;};triangle.duplicate=tr=>{let tri=triangle( tr.points[0].x,tr.points[0].y,tr.points[1].x,tr.points[1].y,tr.points[2].x,tr.points[2].y );tri.style=triangle.duplicateStyle(tr.style);tri.update();return tri;};triangle.duplicateStyle=s=>{if (!s) var s={};return {triangleFill:s.triangleFill?s.triangleFill:"#7f7f7f",exStroke:s.exStroke?s.exStroke:"hsl(0,100%,40%)",inStroke:s.inStroke?s.inStroke:"hsl(0,100%,40%)",gStroke:s.gStroke?s.gStroke:"hsl(300,100%,40%)",oStroke:s.oStroke?s.oStroke:"hsl(240,100%,40%)",hStroke:s.hStroke?s.hStroke:"hsl(180,100%,40%)",nStroke:s.nStroke?s.nStroke:"hsl(120,100%,40%)",brStroke:s.brStroke?s.brStroke:"hsl(0,100%,20%)",x6Stroke:s.x6Stroke?s.x6Stroke:"hsl(15,100%,20%)",x7Stroke:s.x7Stroke?s.x7Stroke:"hsl(30,100%,20%)",x8Stroke:s.x8Stroke?s.x8Stroke:"hsl(45,100%,20%)",x9Stroke:s.x9Stroke?s.x9Stroke:"hsl(60,100%,20%)",x10Stroke:s.x10Stroke?s.x10Stroke:"hsl(75,100%,20%)",x1112Stroke:s.x1112Stroke?s.x1112Stroke:"hsl(90,100%,20%)",x1314Stroke:s.x1314Stroke?s.x1314Stroke:"hsl(105,100%,20%)",x1516Stroke:s.x1516Stroke?s.x1516Stroke:"hsl(120,100%,20%)",x1718Stroke:s.x1718Stroke?s.x1718Stroke:"hsl(135,100%,20%)",x19Stroke:s.x19Stroke?s.x19Stroke:"hsl(150,100%,20%)",x20Stroke:s.x20Stroke?s.x20Stroke:"hsl(165,100%,20%)",x21Stroke:s.x21Stroke?s.x21Stroke:"hsl(180,100%,20%)",x22Stroke:s.x22Stroke?s.x22Stroke:"hsl(195,100%,20%)",x23Stroke:s.x23Stroke?s.x23Stroke:"hsl(210,100%,20%)",x24Stroke:s.x24Stroke?s.x24Stroke:"hsl(225,100%,20%)",x25Stroke:s.x25Stroke?s.x25Stroke:"hsl(240,100%,20%)",x26Stroke:s.x26Stroke?s.x26Stroke:"hsl(255,100%,20%)",x27Stroke:s.x27Stroke?s.x27Stroke:"hsl(270,100%,20%)",x28Stroke:s.x28Stroke?s.x28Stroke:"hsl(285,100%,20%)",x29Stroke:s.x29Stroke?s.x29Stroke:"hsl(300,100%,20%)",x30Stroke:s.x30Stroke?s.x30Stroke:"hsl(315,100%,20%)",x31Stroke:s.x31Stroke?s.x31Stroke:"hsl(330,100%,20%)",x32Stroke:s.x32Stroke?s.x32Stroke:"hsl(345,100%,20%)",exCenter:!!s.exCenter,exCircle:!!s.exCircle,inCenter:!!s.inCenter,inCircle:!!s.inCircle,gCenter:!!s.gCenter,oCenter:!!s.oCenter,oCircle:!!s.oCircle,hCenter:!!s.hCenter,nCenter:!!s.nCenter,nCircle:!!s.nCircle,brCenter:!!s.brCenter,brCircle:!!s.brCircle,x6Center:!!s.x6Center,x7Center:!!s.x7Center,x8Center:!!s.x8Center,x9Center:!!s.x9Center,x10Center:!!s.x10Center,x11Center:!!s.x11Center,x12Center:!!s.x12Center,x13Center:!!s.x13Center,x14Center:!!s.x14Center,x15Center:!!s.x15Center,x16Center:!!s.x16Center,x17Center:!!s.x17Center,x18Center:!!s.x18Center,x19Center:!!s.x19Center,x20Center:!!s.x20Center,x21Center:!!s.x21Center,x22Center:!!s.x22Center,x23Center:!!s.x23Center,x24Center:!!s.x24Center,x25Center:!!s.x25Center,x26Center:!!s.x26Center,x27Center:!!s.x27Center,x28Center:!!s.x28Center,x29Center:!!s.x29Center,x30Center:!!s.x30Center,x31Center:!!s.x31Center,x32Center:!!s.x32Center };};triangle.container={x1:0,y1:0,x2:0,y2:0};let triangles=[];var selection=null,editable=true;let base=cd("baseView");if (status.standalone) ap(base,cd("statusbar"));let axis=ap(base,cd("axisLayer"));axis.axisHidden=false;["Y","X"].forEach(a=>ap(axis,cd(null,"axis"+a)));let draw=ap(base,cd("drawLayer"));let his={data:[],position:0,storage:false,undoButtons:[],redoButtons:[],urPanels:[],save:()=>{if (his.storage) {try{localStorage.setItem("Triangle",JSON.stringify({data:his.data[his.position].data,axisHidden:axis.axisHidden,input:status.input }));}catch(e){his.storage=false;}}},backup:override=>{if (!override) his.data.length=his.position+1;let d=[],td=[];for (var n=0;n<triangles.length;n++) {var tr=triangles[n];d[n]={points:[ tr.points[0].x,tr.points[0].y,tr.points[1].x,tr.points[1].y,tr.points[2].x,tr.points[2].y ],style:triangle.duplicateStyle(tr.style) };td[n]=tr;}if (!override) his.data.push({data:d,triangle:td });else his.data[his.position]={data:d,triangle:td };if (!override) {his.undoButtons.forEach(e=>e.disabled=false);his.position++;}his.save();},revert:p=>{if (selection) selection.resignSelection();his.position=p;let dt=his.data[p];let d=dt.data;while (triangles.length) {rc(triangles[0].node);triangles.shift().visible=false;}for (var n=0;n<d.length;n++) {var tr=dt.triangle[n];if (tr) {var pt=tr.points,pd=d[n].points;pt[0].x=pd[0];pt[0].y=pd[1];pt[1].x=pd[2];pt[1].y=pd[3];pt[2].x=pd[4];pt[2].y=pd[5];}else {var pd=d[n].points;tr=triangle(pd[0],pd[1],pd[2],pd[3],pd[4],pd[5]);dt.triangle[n]=tr;}tr.style=triangle.duplicateStyle(d[n].style?d[n].style:{});triangles[n]=tr;tr.update();ap(draw,tr.node);tr.visible=true;}his.save();his.undoButtons.forEach(e=>e.disabled=p==0);his.redoButtons.forEach(e=>e.disabled=p==(his.data.length-1));his.urPanels.forEach(e=>e.update());}};(()=>{try{let ls=localStorage.getItem("Triangle");if (ls) {let s=JSON.parse(ls),t=[];axis.axisHidden=!!s.axisHidden;axis.className=axis.axisHidden?"hidden":"";if ((s.data?s.data:{}).length) {let d=s.data;for (var n=0;n<d.length;n++) t[n]=null;his.data[0]={data:d,triangle:t};his.storage=true;}else {his.storage=true;throw new Error("Error");}}else {his.storage=true;throw new Error("Error");}}catch(e){his.data[0]=preset();}})();let input=ap(base,cd("inputLayer"));(()=>{let focus=[];var focusType=null;var editable=true;var edited=false;var recomb=false;var duplicated=false;let adj=t=>{return {x:t.clientX-input.clientWidth/2,y:t.clientY-input.clientHeight/2};};let recombination=e=>{let fs=[];Array.from(e.touches).forEach(t=>{let ap=adj(t);let f=focus.reduce((a,f)=>{if (!a) return f;else if (length(ap,a)>length(ap,f)) return f;else return a;},null);if (f) {f.id=t.identifier;fs.push(f);}});if (fs.length) {focus.length=0;fs.forEach(f=>focus.push(f));}else cancel();recomb=false;};let into=ct=>ct.reduce((mt,t)=>{if (mt) {let ap=adj(t);let tr=triangles.find(tr=>{let p=tr.points;let det=cross(p[0],p[1])+cross(p[1],p[2])+cross(p[2],p[0]);if (det) {var j=1;tri((m,m1,m2)=>j&=(cross(p[m1],ap)-cross(p[m2],ap)-cross(p[m1],p[m2]))*det<0);return !!j;}else return false;});if (!tr) return 0;else if (mt==1) return tr;else if (mt===tr) return tr;else return 0;}else return 0;},1);let selectorSize=(e,w)=>{if (w) {if (!e.touches.length) var s=20;else if (e.touches[0].force!==undefined) var s=Array.from(e.touches).reduce((s,t)=>s+t.force/e.touches.length*20,20);else var s=20;}else {if (e.webkitForce!==undefined) var s=e.webkitForce*5+10;else var s=10;}if (focus.length) focus[0].triangle.selectorSize=s;};let cancel=()=>{focus.length=0;focusType=null;};if (status.input=="Touch") {ael(input,"touchstart",e=>{editable=false;let ct=Array.from(e.changedTouches),trs=triangles,fs=[];trs.reverse();ct.forEach(t=>{let ap=adj(t);trs.find(tr=>{let i=tr.points.findIndex(p=>length(ap,p)<=20);if (i>=0) fs.push({id:t.identifier,triangle:tr,corner:i,x:ap.x,y:ap.y});return i>=0;});});if (fs.length&&focusType!="Triangle") {if (fs.reduce((a,f)=>{if (a) {if (a==1) return f.triangle;else return a===f.triangle?f.triangle:0;}else return 0;},1)) {focusType="Point";fs.forEach(f=>focus.push(f));}else cancel();}else if (focus.length+ct.length>2) cancel();else if (focusType=="Triangle") {let tr=focus[0].triangle;if (fs.length) cancel();else if (into(ct)===tr) ct.forEach(t=>{let ap=adj(t);focus.push({id:t.identifier,triangle:tr,corner:-1,x:ap.x,y:ap.y});});else cancel();}else {let tr=into(ct);if (tr!=0&&tr!=1) {ct.forEach(t=>{let ap=adj(t);focus.push({id:t.identifier,triangle:tr,corner:-1,x:ap.x,y:ap.y});});focusType="Triangle";}}if (focus.length) {sa(input,"class","active");focus[0].triangle.becomeSelection();selectorSize(e,true);}else if (selection) selection.resignSelection();trs.reverse();e.preventDefault();});ael(input,"touchmove",e=>{sa(input,"class","moving"+(focus.length?" active":""));if (focus.length) {if (recomb) recombination(e);selectorSize(e,true);let tr=focus[0].triangle;let p=tr.points;if (focusType=="Point") {Array.from(e.changedTouches).forEach(t=>{let ap=adj(t);let f=focus.find(f=>f.id==t.identifier);if (f) {add(minus(ap,f),p[f.corner]);copy(ap,f);}});input.edited=true;tr.update();}else if (focusType=="Triangle") {if (focus.length==e.touches.length) switch (focus.length) {case 1:var ap=adj(e.touches[0]),f=focus[0];tri(n=>add(minus(ap,f),p[n]));copy(ap,f);break;case 2:let ap0=adj(e.touches[0]),ap1=adj(e.touches[1]);let f0=focus.find(f=>f.id==e.touches[0].identifier);let f1=focus.find(f=>f.id==e.touches[1].identifier);if (f0&&f1&&(f0!=f1)) {let c=mid(f0,f1),nc=mid(ap0,ap1),m=div(minus(ap0,ap1),minus(f0,f1));tri(n=>copy(plus(times(minus(p[n],c),m),nc),p[n]));copy(ap0,f0);copy(ap1,f1);}break;}input.edited=true;tr.update();}}e.preventDefault();});let te=e=>{if (e.touches.length) {var w=false;Array.from(e.touches).forEach(t=>{let ap=adj(t),f=focus.find(f=>f.id==t.identifier);if (f) {copy(ap,f);w=true;}});if (w) selectorSize(e,true);recomb=true;}else {if (edited) his.backup();focus.length=0;focusType=null;ra(input,"class");editable=true;edited=false;}e.preventDefault();};ael(input,"touchend",te);ael(input,"touchcancel",te);ael(input,"touchforcechange",e=>selectorSize(e,true));}else {ael(input,"mousedown",e=>{editable=false;let ap=adj(e);triangles.find(tr=>{let i=tr.points.findIndex(p=>length(ap,p)<=10);if (i>=0) {focus.push({id:"mouse",triangle:tr,corner:i,x:ap.x,y:ap.y});focusType="Point";}return i>=0;});if (!focus.length) {let tr=into([e]);if (tr) {focus.push({id:"mouse",triangle:tr,corner:-1,x:ap.x,y:ap.y});focusType="Triangle";}}if (focus.length) {sa(input,"class","active");focus[0].triangle.becomeSelection();selectorSize(e,false);}else if (selection) selection.resignSelection();e.preventDefault();});ael(input,"mousemove",e=>{if (!editable) {sa(input,"class","moving"+(focus.length?" active":""));if (focus.length) {selectorSize(e,false);let ap=adj(e),f=focus[0];let tr=f.triangle;if (focusType=="Point") {let i=tr.centers.in;if (e.shiftKey&&e.altKey) {let m=div(minus(ap,i),minus(f,i));tr.points.forEach(p=>copy(plus(times(minus(p,i),m),i),p));}else if (e.shiftKey) {let l=length(tr.points[f.corner],i);tr.points.forEach(p=>copy(plus(coef(minus(p,i),length(ap,i)/l),i),p));}else if (e.altKey) {let m=div(coef(minus(ap,i),1/length(ap,i)),coef(minus(f,i),1/length(f,i)));tr.points.forEach(p=>copy(plus(times(minus(p,i),m),i),p));}else copy(ap,tr.points[f.corner]);edited=true;tr.update();}else if (focusType=="Triangle") {if (e.altKey&&!duplicated) {var tra=triangle.duplicate(tr);triangles.push(tra);tra.visible=true;draw.appendChild(tra.node);tr.resignSelection();tra.becomeSelection();f.triangle=tra;duplicated=true;selectorSize(e,false);}else var tra=tr;tra.points.forEach(p=>add(minus(ap,f),p));edited=true;tra.update();}copy(ap,f);}}e.preventDefault();});let mu=e=>{if (edited) his.backup();focusType=null;focus.length=0;editable=true;edited=false;duplicated=false;ra(input,"class");e.preventDefault();};ael(input,"mouseup",mu);ael(input,"mouseout",mu);let fc=e=>{selectorSize(e,false);e.preventDefault();};ael(input,"webkitmouseforcedown",fc);ael(input,"webkitmouseforceup",fc);ael(input,"webkitmouseforcechanged",fc);}ael(html,"keydown",e=>{let s=selection,d=detail.runningDetail;if (s&&(!d)) {switch (e.key) {case "ArrowLeft":s.points.forEach(p=>p.x-=5);s.update();break;case "ArrowRight":s.points.forEach(p=>p.x+=5);s.update();break;case "ArrowUp":s.points.forEach(p=>p.y-=5);s.update();break;case "ArrowDown":s.points.forEach(p=>p.y+=5);s.update();break;}}e.preventDefault();});ael(html,"keyup",e=>{let s=selection;var d=detail.runningDetail;switch (e.key) {case "Enter":if (detail.runningDetail) {if (d.tabs) {var d=d.panels[d.focus];if (d.focus>=0) d.list[d.focus].panel.action(d,d.list[d.focus].panel);else if (d.focus==-1) detail.hideDetail();else d.group.setFocus(d.group.focus);}else {if (d.focus>=0) d.list[d.focus].panel.action(d,d.list[d.focus].panel);else detail.hideDetail();}}break;case "ArrowLeft":if (d) {if (d.tabs) {d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (l.col) d.setFocus(d.focus-1,true);else d.setFocus(-1);}else if (d.focus==-1) d.setFocus(d.list.length-1,true);else if (d.group.focus>0) d.group.setFocus(d.group.focus-1);}else {if (d.focus>=0) {var l=d.list[d.focus];if (l.col) d.setFocus(d.focus-1,true);else d.setFocus(-1);}else d.setFocus(d.list.length-1,true);}}else if (s) his.backup();break;case "ArrowRight":if (d) {if (d.tabs) {d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (d.panels[l.row].length-l.col-1) d.setFocus(d.focus+1);else d.setFocus(-1);}else if (d.focus==-1) d.setFocus(0,true);else if (d.group.focus<(d.group.panels.length-1)) d.group.setFocus(d.group.focus+1);}else {if (d.focus>=0) {var l=d.list[d.focus];if (d.panels[l.row].length-l.col-1) d.setFocus(d.focus+1);else d.setFocus(-1);}else d.setFocus(0,true);}}else if (s) his.backup();break;case "ArrowUp":if (d) {if (d.tabs) {var d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (l.row) {var m=d.panels[l.row-1].length;if (l.col>(m-1)) d.setFocus(d.focus-l.col-1,true);else d.setFocus(d.focus-m,true);}else d.group.setExtracted(false);}else d.setFocus(d.list.length-1,true);}else {if (d.focus>=0) {var l=d.list[d.focus];if (l.row) {var m=d.panels[l.row-1].length;if (l.col>(m-1)) d.setFocus(d.focus-l.col-1,true);else d.setFocus(d.focus-m,true);}else {var m=d.panels[d.panels.length-1].length;if (l.col>(m-1)) d.setFocus(d.list.length-1,true);else d.setFocus(d.list.length-m+l.col,true);}}else d.setFocus(d.list.length-1,true);}}else if (s) his.backup();break;case "ArrowDown":if (d) {if (d.tabs) {var d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (d.panels.length-l.row-1) {var m=d.panels[l.row+1].length,n=d.panels[l.row].length;if (l.col>(m-1)) d.setFocus(d.focus+n+m-l.col,false);else d.setFocus(d.focus+n,false);}else d.group.setExtracted(false);}else d.setFocus(0,true);}else {var d=d.panels[d.focus];if (d.focus>=0) {var l=d.list[d.focus];if (d.panels.length-l.row-1) {var m=d.panels[l.row+1].length,n=d.panels[l.row].length;if (l.col>(m-1)) d.setFocus(d.focus+n+m-l.col,false);else d.setFocus(d.focus+n,false);}else {var m=d.panels[0].length;if (l.col>(m-1)) d.setFocus(m-1,false);else d.setFocus(l.col,false);}}else d.setFocus(0,true);}}else if (s) his.backup();break;case "Backspace":if (d) detail.hideDetail();else if (s) {var d=triangles.length;for (var n=0;n<triangles.length;n++) {if (d<n) triangles[n-1]=triangles[n];else if (triangles[n]==s) d=n;}triangles.length--;s.visible=false;rc(selection.node);s.resignSelection();his.backup();}break;case "m":case "M":if (d) detail.hideDetail();else detail.showDetail();break;case "Z":var h=his.position+1;if (h<his.data.length) his.revert(h);break;case "z":var h=his.position-1;if (h>=0) his.revert(h);break;case "e":if (s) {s.style.exCenter=!s.style.exCenter;s.updateStyle();his.backup();}break;case "E":if (s) {s.style.exCircle=!s.style.exCircle;s.updateStyle();his.backup();}break;case "i":if (s) {s.style.inCenter=!s.style.inCenter;s.updateStyle();his.backup();}break;case "I":if (s) {s.style.inCircle=!s.style.inCircle;s.updateStyle();his.backup();}break;case "g":case "G":if (s) {s.style.gCenter=!s.style.gCenter;s.updateStyle();his.backup();}break;case "o":if (s) {s.style.oCenter=!s.style.oCenter;s.updateStyle();his.backup();}break;case "O":if (s) {s.style.oCircle=!s.style.oCircle;s.updateStyle();his.backup();}break;case "h":case "H":if (s) {s.style.hCenter=!s.style.hCenter;s.updateStyle();his.backup();}break;case "n":if (s) {s.style.nCenter=!s.style.nCenter;s.updateStyle();his.backup();}break;case "N":if (s) {s.style.nCircle=!s.style.nCircle;s.updateStyle();his.backup();}break;case "s":case "S":case "ß":case "Í":exp(true,e.altKey);case "b":case "B":case "∫":case "ı":exp(false,e.altKey);break;case "p":case "P":window.print();break;case "f":case "F":fullscreen();break;}e.preventDefault();});})();let detail=ap(base,cd("detailLayer","hide"));detail.panel=panel=>{let view={panels:panel,list:[],style:{tintColor:"#007aff" },name:"",icon:"■",group:null,node:cd(null,"panel"),buttons:[],doneButton:cd(null,"done"),backTint:cd(null,"backTint"),desc:cd(null,"desc"),visible:false,focus:0,update:()=>{view.list.length=0;view.panels.forEach((p,n)=>p.forEach((p,m)=>view.list.push({row:n,col:m,panel:p})));if (view.buttons.length>view.list.length) {for (var n=view.list.length;n<view.buttons.length;n++) rc(view.buttons[n]);view.buttons.length=view.list.length;}else if (view.buttons.length<view.list.length) {for (var n=view.buttons.length;n<view.list.length;n++) {var b=cd(null,"button");b.index=n;ap(b,document.createTextNode(""));sa(b,"role","button");view.buttons[n]=b;view.node.insertBefore(b,view.doneButton);}}for (var m=-1;m<view.list.length;m++) (n=>{if (n>=0) {var b=view.buttons[n];let l=view.list[n];let p=view.list[n].panel;var trigger=false;if (!initialized) switch (status.input) {case "Touch":ael(b,"touchstart",e=>{trigger=true;e.preventDefault();});let tm=e=>{trigger=false;e.preventDefault();};ael(b,"touchmove",tm);ael(b,"touchcancel",tm);ael(b,"touchend",e=>{if (trigger) {if (view.group) view.group.setExtracted(true);if ((view.focus==b.index)&&p.action) p.action(view,p);else if (!p.disabled) view.setFocus(b.index);trigger=false;}e.preventDefault();});break;case "Mouse":ael(b,"mouseover",e=>{if (view.group) view.group.setExtracted(true);if (!p.disabled) view.setFocus(b.index);e.preventDefault();});ael(b,"mouseup",e=>{if (p.action) p.action(view,p);e.preventDefault();});break;}b.firstChild.textContent=p.icon;b.title=p.name;b.style.color=view.style.tintColor;b.className="button"+(p.disabled?" disabled":"");view.setSelected(n,p.selected);view.setPosition(b,l.col,l.row);sa(b,"aria-disabled",view.list[n].panel.disabled?"true":"false");}else {var b=view.doneButton;if (!initialized) switch (status.input) {case "Touch":ael(b,"touchend",e=>{if (view.focus==-1) detail.hideDetail();else view.setFocus(-1);e.preventDefault();});break;case "Mouse":ael(b,"mouseover",e=>{view.setFocus(-1);e.preventDefault();});ael(b,"mouseup",e=>{detail.hideDetail();e.preventDefault();});break;}b.style.color=view.style.tintColor;view.setPosition(b,3,view.panels.length-1);sa(b,"aria-disabled","false");}sa(b,"aria-selected","false");})(m);view.backTint.style.backgroundColor=view.style.tintColor;view.setFocus(view.focus,false,true);if (!view.group) view.node.style.height=(85*view.panels.length+45)+"px";if (!initialized) switch (status.input) {case "Touch":ael(view.node,"touchend",()=>detail.bubble=true);break;case "Mouse":ael(view.node,"mouseup",()=>detail.bubble=true);break;}initialized=true;view.desc.style.color=view.style.tintColor;},setSelected:(n,t)=>{view.buttons[n].style.backgroundColor=t?translucent(view.style.tintColor,0.5):"transparent";view.list[n].panel.selected=!!t;},setFocus:(n,rev,all)=>{let l=view.list,f=view.focus;if (n>=0) {var b=n;if (l[n].panel.disabled) {if (all) {if (rev) for (var n=l.length+b;n>b;n--) {if (!l[n%l.length].panel.disabled) break;}else for (var n=b;n<l.length+b;n++) {if (!l[n%l.length].panel.disabled) break;}n=n%l.length;if (n==b) n=-1;}else {var found=false;if (rev) for (var n=b;n>=0;n--) {if (!l[n].panel.disabled) {found=true;break;}}else for (var n=b;n<l.length;n++) {if (!l[n].panel.disabled) {found=true;break;}}if (!found) n=-1;}}}var b=null;if (f>=0) {b=view.buttons[f];b.style.color=l[f].panel.disabled?"#999":view.style.tintColor;}else if (f==-1) {b=view.doneButton;b.style.color=view.style.tintColor;}else if (view.group&&(n>-2)) view.group.setExtracted(true);if (b) {sa(b,"aria-selected","false");b=null;}if (n>=0) {var b=view.buttons[n];view.setPosition(view.backTint,view.list[n].col,view.list[n].row);view.desc.textContent=view.list[n].panel.name;}else if (n==-1) {var b=view.doneButton;view.setPosition(view.backTint,3,view.panels.length-1);view.desc.textContent="";}else {view.setPosition(view.backTint,0,-1);view.desc.textContent=view.name;}if (b) {sa(b,"aria-selected","true");b.style.color="#fff";}view.focus=n;},setPosition:(n,c,r)=>{let rs=view.panels.length;if (r<0) {c=0;n.style.top="-85px";}else n.style.top=(85*r+5)+"px";n.style.left=`calc( ( 100% - 25px ) / 4 * ${c} + ${c*5+5}px )`;n.style.right=`calc( ( 100% - 25px ) / 4 * ${3-c} + ${-c*5+20}px )`;}};var initialized=false;ap(view.node,view.desc);ap(view.node,view.backTint);let d=ap(view.node,view.doneButton);d.textContent=d.title="Done";view.update();return view;};detail.group=panels=>{let gp={panels:panels,node:cd(null,"group"),nav:cd(null,"extracted"),tabs:[],backFocus:cd(null,"backFocus"),backTint:cd(null,"backTint"),focus:0,extracted:true,update:part=>{let p=gp.panels,t=gp.tabs,nd=gp.node,nv=gp.nav;if ((!part)||(t.length!=p.length)) {if (t.length>p.length) {for (var n=p.length;n<t.length;n++) rc(t[n]);t.length=p.length;}else if (t.length<p.length) {for (var n=t.length;n<p.length;n++) {var b=cd(null,"tab");b.index=n;ap(b,cd());sa(b,"role","tab");t[n]=b;ap(nv,b);}}while (nd.firstChild) rc(nd.firstChild);ap(nd,nv.parentNode);}p.forEach((pn,n)=>{let tn=t[n];let tf=tn.firstChild;tn.firstChild.textContent=pn.icon;tn.title=pn.name;tn.style.left=(65*n+5)+"px";tn.style.color=pn.style.tintColor;tn.index=n;if (status.input=="Touch") {var trigger=false;ael(tf,"touchstart",()=>{trigger=true;});ael(tf,"touchmove",()=>{trigger=false;});ael(tf,"touchend",()=>{if (trigger) {gp.setExtracted(false);gp.setFocus(n);detail.bubble=true;trigger=false;}});}else if (status.input=="Mouse") {ael(tf,"mouseover",()=>{gp.setExtracted(false);});ael(tf,"mouseup",()=>{gp.setFocus(n);detail.bubble=true;});}ap(nd,pn.node);if ((gp.focus==n)&&(pn.focus<-1)) {pn.setFocus(0);gp.setExtracted(true);}else if ((gp.focus!=n)&&(pn.focus>=-1)) {pn.setFocus(-2);}pn.group=gp;pn.update();});gp.setFocus(part?gp.focus:0);gp.setExtracted(true);},setFocus:n=>{for (var m=0;m<gp.tabs.length;m++) {gp.tabs[m].className="tab"+((n==m)?" selected":"");gp.panels[m].node.className="panel"+((n==m)?"":" hidden");}gp.node.style.height=(85*gp.panels[n].panels.length+95)+"px";gp.backFocus.style.left=(65*n+5)+"px";gp.backFocus.style.backgroundColor=gp.panels[n].style.tintColor;gp.backTint.style.backgroundColor=translucent(gp.panels[n].style.tintColor,status.filter?0.6:0.9);gp.focus=n;},setExtracted:e=>{gp.nav.className=e?"extracted":"chooser";if (!e) gp.panels[gp.focus].setFocus(-2);gp.extracted=e;}};ap(cd(null,"nav"),gp.nav);ap(gp.nav,gp.backFocus);ap(gp.nav.parentNode,gp.backTint);gp.update();return gp;};detail.main=detail.panel([ [ {icon:"◀︎",name:"Undo",disabled:true,action:function(){his.revert(his.position-1);}},{icon:"▶︎",name:"Redo",disabled:true,action:function(){his.revert(his.position+1);}},{icon:"╋",name:"Show/Hide Axis",disabled:false,selected:!axis.axisHidden,action:function(v){axis.axisHidden=this.selected;axis.className=this.selected?"hidden":"";v.setSelected(2,!this.selected);his.backup(true);}}],[ {icon:"P",name:"Call Preset",action:function(){his.data.length=his.position+1;his.data.push(preset());his.revert(his.position+1);}},{icon:"⎙",name:"Print",action:function(){window.print();}}] ]);his.urPanels.push(detail.main);his.undoButtons.push(detail.main.panels[0][0]);his.redoButtons.push(detail.main.panels[0][1]);detail.trigger=ap(base,cd("detailTrigger"));detail.trigger.style.backgroundColor=detail.main.style.tintColor;detail.trigger.method=()=>detail.showDetail();detail.runningDetail=null;detail.showDetail=()=>{if (selection) {selection.update();ap(detail,selection.panelGroup.node);selection.panelGroup.visible=true;detail.runningDetail=selection.panelGroup;}else {detail.main.update();ap(detail,detail.main.node);detail.main.visible=true;detail.runningDetail=detail.main;}detail.className="mid";setTimeout(()=>detail.className="",0);};detail.hideDetail=()=>{detail.className="mid";setTimeout(()=>{detail.className="hide";rc(detail.runningDetail.node);detail.runningDetail.visible=false;detail.runningDetail=null;},1000);};detail.bubble=false;detail.method=function(){if (!this.bubble) {this.hideDetail();this.bubble=false;}};let dialog=cd("dialogLayer","show");dialog.className="hide";let exp=(svg,only)=>{let ct=triangle.container;let z=only|axis.axisHidden;let w=ct.x2-ct.x1,h=ct.y2-ct.y1;if (svg) {var code=`<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="${w*1.2}" height="${h*1.2}" viewBox="${-w*0.1+ct.x1} ${-h*0.1+ct.y1} ${w*1.2} ${h*1.2}"><title>Triangle</title>`+(z?"":`<line x1="0" y1="${-h*0.1+ct.y1}" x2="0" y2="${h*0.1+ct.y2}" stroke-width="1" stroke="#666" /><line x1="${-w*0.1+ct.x1}" y1="0" x2="${w*0.1+ct.x2}" y2="0" stroke-width="1" stroke="#666" />`);triangles.forEach(tr=>{code+=`<path d="M${tr.points[0].x},${tr.points[0].y}L${tr.points[1].x},${tr.points[1].y}L${tr.points[2].x},${tr.points[2].y}Z" fill="${tr.style.triangleFill}" />`;var ex=0,br=0,exc=0;if (!only) Array.from(tr.node.childNodes).forEach((en,n)=>{if (n>1) {if (en.className.match(/center/)) {var k=en.className.match(/center ([a-z0-9]+)/)[1];var p=tr.centers[k];if (k=="ex") {code+=`<circle cx="${p[ex].x}" cy="${p[ex].y}" r="10" fill="${en.style.borderColor}" stroke="none" />`;ex++;}else if (k=="br") {code+=`<circle cx="${p[br].x}" cy="${p[br].y}" r="10" fill="${en.style.borderColor}" stroke="none" />`;br++;}else code+=`<circle cx="${p.x}" cy="${p.y}" r="10" fill="${en.style.borderColor}" stroke="none" />`;}if (en.className.match(/circle/)) {var k=en.className.match(/circle ([a-z0-9]+)/)[1];var p=tr.centers[k];if (k=="ex") {code+=`<circle cx="${p[exc].x}" cy="${p[exc].y}" r="${p[exc].r}" fill="none" stroke="${en.style.borderColor}" stroke-width="2" />`;exc++;}else code+=`<circle cx="${p.x}" cy="${p.y}" r="${p.r}" fill="none" stroke="${en.style.borderColor}" stroke-width="2" />`;}}});});code+="</svg>";window.open("data:image/svg+xml;base64,"+btoa(code));}else {var code=`<!doctype html><html><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" /><title>Triangle</title><style type="text/css">html,body{margin:0px;width:100%;height:100%;}@media print{#frame{position:absolute;left:0px;right:0px;top:0px;bottom:0px;}}@media screen{#frame{position:fixed;left:0px;right:0px;top:0px;bottom:0px;}}</style></head><body style="user-select:none;-webkit-user-select:none;cursor:default;"><div id="frame">`+(z?"":`<div style="border-right:solid #666 1px;position:absolute;z-index:1;left:0%;right:50%;top:0%;bottom:0%;"></div><div style="border-bottom:solid #666 1px;position:absolute;z-index:1;left:0%;right:0%;top:0%;bottom:50%;"></div>`);triangles.forEach(tr=>{var ce=0,ci=0;let tn=tr.triangleNode,cen=tr.centerNodes,cin=tr.circleNodes;let tnn=tn.firstChild;code+=`<div style="position:absolute;z-index:${z+1};top:50%;transform:${tn.style.transform};transform-origin:${tn.style.transformOrigin};left:${tn.style.left};right:${tn.style.right};height:${tn.style.height};"><div style="border:solid transparent 0px;border-left-width:${tnn.style.borderLeftWidth};border-right-width:${tnn.style.borderRightWidth};border-top-width:${tnn.style.borderTopWidth};border-top-color:${tnn.style.borderTopColor};position:absolute;left:0px;top:0px;width:0px;height:0px;"></div></div>`;if (!only) Array.from(tr.node.childNodes).forEach((en,n)=>{if (n>0) {if (en.className.match(/center/)) {ce=1;code+=`<div style="border:solid ${en.style.borderColor} 10px;border-radius:50%;transform:translate(-10px,-10px);position:absolute;z-index:${z+2};width:0px;height:0px;left:${en.style.left};top:${en.style.top};"></div>`;}if (en.className.match(/circle/)) {ci=1;code+=`<div style="border:solid ${en.style.borderColor} 2px;border-radius:50%;box-sizing:border-box;position:absolute;z-index:${z+2+ce};left:${en.style.left};right:${en.style.right};top:${en.style.top};bottom:${en.style.bottom};"></div>`;}}});z+=1+ce+ci;});code+="</div></body></html>";window.open("data:text/html;base64,"+btoa(code));}};his.revert(0);status.inputSetup();with (body) while (firstChild) rc(firstChild);ap(body,base);})();